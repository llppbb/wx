<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <!--禁止页面缩放-->
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
    <meta http-equiv="proma" content="no-cache" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <title>幸运大转盘</title>
    <!-- 图片轮播 -->
    <link type="text/css" href="css/styleLunbo.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="css/styleCJ.css" />
    <link rel="stylesheet" type="text/css" href="../common/css/common.css" />
    <style>
        .noData_img {
            width: 40%;
            margin-left: 30%;
            margin-top: 1.2rem;
            margin-bottom: 0.3rem;
        }

        .noData_img img,
        .noData_img1 img {
            width: 100%;
            display: block;
        }

        .noData_img1 {
            width: 60%;
            margin-left: 20%;
            margin-top: .2rem;
        }

        .noData_text {
            font-size: 0.15rem;
            color: rgb(51, 51, 51);
            text-align: center;
        }
        /*轮播*/

        .img_gallery {
            height: 1.5rem;
        }

        .main_img ul {
            width: 100%;
        }

        .img_gallery img {
            width: 100%;
            height: 100%;
        }

        .swiper-container {
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            z-index: 1;
            height: 1.7rem;
        }

        .swiper-container-horizontal>.swiper-pagination {
            bottom: 0rem !important;
            left: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div class="wrap" style="display:none;">
        <div class="img_gallery" style="display:none">
            <div class="point">
                <a href="#">1</a>
                <a href="#">2</a>
                <a href="#">3</a>
            </div>
            <div class="main_img">
                <ul id="img_box">
                    <!-- <li><img src="http://img03.sogoucdn.com/app/a/07/0c5e3f9adae9c4ea82f9c58350a7843f"/></li> -->
                </ul>
                <a href="javascript:;" id="btn_prev"></a>
                <a href="javascript:;" id="btn_next"></a>
            </div>
        </div>
        <div class="top" id="top">
            <div class="shanDeng" id="deng">
                <div id="luck">
                    <!-- luck -->
                    <table>
                        <tr>
                            <td class="luck-unit luck-unit-0"></td>
                            <td class="luck-unit luck-unit-1"></td>
                            <td class="luck-unit luck-unit-2"></td>
                            <td class="luck-unit luck-unit-3" attr_id="3"></td>
                        </tr>
                        <tr>
                            <td class="luck-unit luck-unit-11"></td>
                            <td rowspan="2" colspan="2" class="cjBtn" id="btn"></td>
                            <td class="luck-unit luck-unit-4"></td>
                        </tr>
                        <tr>
                            <td class="luck-unit luck-unit-10"></td>
                            <td class="luck-unit luck-unit-5"></td>
                        </tr>
                        <tr>
                            <td class="luck-unit luck-unit-9"></td>
                            <td class="luck-unit luck-unit-8"></td>
                            <td class="luck-unit luck-unit-7"></td>
                            <td class="luck-unit luck-unit-6"></td>
                        </tr>
                    </table>
                </div>
                <!-- luckEnd -->
                <div class="yaotop"><img src="pic/gantop.png" /></div>
                <div class="yaobot"><img src="pic/ganbot.png" /></div>

            </div>
        </div>
        <div class="checked">
            <!--查看中奖奖品-->
            <div class="checkedJiang"></div>
        </div>

        <div class="zhongLsit">
            <div class="zhongLsitNull">
                <p>中奖名单</p>
            </div>
            <div id="con">
                <ul style="top: -96px;" id="jiangList">
                    <!-- <li>138****3839 抽中 麦当劳 50元代金券1</li>
                    <li>138****3839 抽中 麦当劳 50元代金券2</li>
                    <li>138****3839 抽中 麦当劳 50元代金券3</li>
                    <li>138****3839 抽中 麦当劳 50元代金券4</li>
                    <li>138****3839 抽中 麦当劳 50元代金券5</li>
                    <li>138****3839 抽中 麦当劳 50元代金券6</li>
                    <li>138****3839 抽中 麦当劳 50元代金券7</li>
                    <li>138****3839 抽中 麦当劳 50元代金券8</li>
                    <li>138****3839 抽中 麦当劳 50元代金券9</li> -->
                </ul>
            </div>
        </div>

        <div class="activeState">
            <div class="null">
                <p>活动状态</p>
                <p class="state_">进行中</p>
            </div>
            <div class="start_time">
                <p>开始时间 1111.11.11 </p>
            </div>
            <div class="end_time">
                <p>结束时间 1111.11.11 </p>
            </div>
        </div>

        <div class="prizeIntroduce">
            <div class="prizeIntroducenull">
                <p>奖品介绍</p>
            </div>
            <div class="swiper-container">
                <div class="swiper-wrapper"></div>
                <!-- Add Pagination -->
                <div class="swiper-pagination"></div>
            </div>
        </div>

        <div class="activeIntroduce">
            <div class="null activeIntroduce_null">
                <p>活动介绍</p>
            </div>
            <div class="centenIntroduce">
                <p></p>
            </div>
        </div>

        <!--未登录 提示 -->
        <div class="alertkuang maskContent">
            <div class="alertkuang_img" style="display:none"><img src="pic/pop1.png" /></div>
            <div class="alertkuang_bot">
                <p class="palert">请先绑定手机号便于发奖</p>
                <div class="get_code_f">
                    <input type="button" class="yanzhengma get_code" value="获取验证码" />
                    <input type="number" class="inp1" id="inp3jifen" placeholder="请输入手机号">
                </div>
                <input type="number" class="inp2" id="inp4jifen" placeholder="短信验证码">
                <div class="quxiao" id="quxiao_btn">取消</div>
                <div class="queding queding_btn">确定</div>
            </div>
        </div>
        <!-- 绑定手机中奖 -->
        <div class="alertkuang zhoangalert">
            <div class="alertkuang_img zhoangalert_img">
                <img id="getJiang_img" src="pic/icon_selected_wx.png" class="jiangimage" />
                <p class="jiangName" id="getJiang_text">恭喜您！获得XX产品！</p>
            </div>
            <div class="alertkuang_bot">
                <div class="quxiao no">取消</div>
                <div class="queding yes" id="yesstate">查看奖品</div>
            </div>
        </div>

        <!-- 没有中奖  谢谢参与 -->
        <div class="alertkuang thankesalert">
            <div class="thankesalerttishi">很遗憾！没有中奖！</div>
            <div class="quxiao no">取消</div>
            <div class="queding yes" id="continue">接着抽奖</div>
        </div>

        <!-- 花费积分 的弹窗绑定手机 -->
        <div class="alertkuang jinfenBIndmobile">
            <div class="alertkuang_img jinfenBIndmobile_img1">
                <p id="jinfenBIndmobileP">您今天的免费抽奖次数已用完，再次抽奖将花费0积分，请绑定手机以便获取您的积分信息。</p>
            </div>
            <div class="alertkuang_bot">
                <div class="get_code_f">
                    <input type="button" class="yanzhengma get_code" value="获取验证码" />
                    <input type="number" class="inp1" id="inp1jifen" placeholder="请输入手机号">
                </div>
                <input type="number" class="inp2" id="inp2jifen" placeholder="短信验证码">
                <div class="quxiao quxiao_btn">取消</div>
                <div class="queding queding_btn">确定</div>
            </div>
        </div>

        <!-- 积分不足  -->
        <div class="alertkuang no_jifen">
            <div class="alertkuang_img jinfenBIndmobile_img">
                <p>您的积分不足，<br/>商城有免费商品，不妨去看看</p>
            </div>
            <div class="alertkuang_bot">
                <div class="quxiao no">取消</div>
                <div class="queding yes">去商城看看</div>
            </div>
        </div>

        <!-- 激活会员  -->
        <div class="alertkuang active">
            <div class="alertkuang_img jinfenBIndmobile_img">
                <p>大奖还未被抽走，您的积分不足，激活会员卡可获得抽奖机会</p>
            </div>
            <div class="alertkuang_bot">
                <div class="quxiao" id="activeQuxiao">取消</div>
                <div class="queding" id="activeQueding">激活会员卡</div>
            </div>
        </div>

        <!-- 不绑定手机 放弃奖品 -->
        <div class="alertkuang no_bind_no_jiang">
            <div class="alertkuang_img jinfenBIndmobile_img">
                <p class="addreddNoBind">如果不绑定手机号视为放弃奖品，确定要放弃吗？</p>
            </div>
            <div class="alertkuang_bot">
                <div class="quxiao no" id="guanbi">确定</div>
                <div class="queding yes" id="jixubang">绑定手机号</div>
            </div>
        </div>
        <!-- 不填写地址 放弃奖品 -->
        <div class="alertkuang no_bind_no_address">
            <div class="alertkuang_img jinfenBIndmobile_img">
                <p class="addreddNoBind">如果不填写地址将视为放弃奖品，确定要放弃吗？</p>
            </div>
            <div class="alertkuang_bot">
                <div class="quxiao no_bind_no_address_no">确定</div>
                <div class="queding no_bind_no_address_cont">继续填写</div>
            </div>
        </div>
        <!--  免费次数用完  还需话费提示 -->
        <div class="alertkuang jifenneed">
            <div class="alertkuang_img jinfenBIndmobile_img">
                <p>本次抽奖将花费<span id="point">0</span>积分，是否继续？</p>
            </div>
            <div class="alertkuang_bot">
                <div class="quxiao no">取消</div>
                <div class="queding jifenneed_yes yes">积分抽奖</div>
            </div>
        </div>
        <!--  您今日的抽奖次数已用完 请明日再来 -->
        <div class="alertkuang shownumberDeil">
            <div class="alertkuang_img jinfenBIndmobile_img">
                <p>您今日的抽奖次数已用完，请明日再来。</p>
            </div>
            <div class="alertkuang_bot">
                <div class="queding quedingone yes">确认</div>
            </div>
        </div>
    </div>

    <div class="noData" style="display:none">
        <div class="noData_img">
            <img src="pic/nodata.png" />
        </div>
        <div class="noData_text">你来晚了<br>又错过了一波大奖</div>
        <div class="noData_img1">
            <img src="pic/img_kuo.png" />
        </div>
    </div>

    <div class="shezhi_tishi">
        <p></p>
    </div>
    <input type="hidden" id="raffleid">

    <script src="../common/officialJs/jquery-1.8.2.min.js"></script>
    <script src="../common/officialJs/md5.js"></script>
    <script src="../common/officialJs/fontSize.js"></script>
    <script src="js/swiper.min.js"></script>
    <script src="js/ygundong.js"></script>
    <script src="../common/customJs/URL.js"></script>
    <script src="../common/customJs/AJAX.js"></script>
    <script src="../common/customJs/common.js"></script>
    <script src="../common/customJs/getUserMes.js"></script>
    <script src="../common/customJs/wxShare.js"></script>
    <script src="js/common.js"></script>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <!-- 图片轮播 -->
    <script type="text/javascript" src="js/jquery.event.drag.js"></script>
    <script type="text/javascript" src="js/jquery.touchSlider.js"></script>
    <script type="text/javascript" src="js/jqlunbo.js"></script>
    <script>
        var arr = []; //得到 中奖的 位置
        var click = 1; //用作判断 是否点击
        var isUsingPoint = 0; //不花费积分
        var codeJava = "";
        var openIdJava = getUrlParam("openId");
        if (!getStorage("userData")) {
            window.location.href = WX_URL + "HXXCServiceWeChat/wechat/wechat_verify";
        } else {
            var userMes = getStorage("userData"); //页面初始数据
        }
        // var userMes = getUserMes(codeJava,openIdJava);
        var uid = userMes.uid;
        var openid = userMes.openId;
        var mobile = userMes.mobile;
        // 城市 id
        var cityid = getUrlParam("cityId");
        var nohouse = getUrlParam("nohouse");
        if (nohouse != 1) {
            // 返回  商城 主页
            // goHomeBtn('body');
        }
        var luck = {
            index: -1, //当前转动到哪个位置，起点位置
            count: 0, //总共有多少个位置
            timer: 0, //setTimeout的ID，用clearTimeout清除
            speed: 20, //初始转动速度
            times: 0, //转动次数
            cycle: 50, //转动基本次数：即至少需要转动多少次再进入抽奖环节
            prize: -1, //中奖位置
            init: function(id) {
                if ($("#" + id).find(".luck-unit").length > 0) {
                    $luck = $("#" + id);
                    $units = $luck.find(".luck-unit");
                    this.obj = $luck;
                    this.count = $units.length;
                    $luck.find(".luck-unit-" + this.index).children(".tbBg").addClass("active2");
                };
            },
            roll: function() {
                var index = this.index;
                var count = this.count;
                var luck = this.obj;
                $(luck).find(".luck-unit-" + index).children(".tbBg").removeClass("active2");
                index += 1;
                if (index > count - 1) {
                    index = 0;
                };
                $(luck).find(".luck-unit-" + index).children(".tbBg").addClass("active2");
                this.index = index;
                return false;
            },
            stop: function(index) {
                this.prize = index;
                return false;
            }
        };

        //闪灯效果
        var num = 0;
        $(".shanDeng").attr("class", function() {
            setInterval(function() {
                num++;
                if (num % 2 == 0) {
                    $('#deng').addClass("shanDeng2");
                } else {
                    $('#deng').addClass("shanDeng");
                    $('#deng').removeClass('shanDeng2');
                }
            }, 500)
        })

        luck.init('luck'); //初始化 九宫格

        getlist();

        //点击抽奖
        $("#btn").click(function() {
            if (mobile == 0) {
                $(".track_matte").show();
                $(".maskContent").show();
                return false;
            } else {
                zhuan($("#raffleid").val());
            }
        });

        $("#continue").click(function() {
            $(".thankesalert").hide();
            $(".track_matte").hide();
            zhuan($("#raffleid").val());
        });

        //话费积分抽奖  确定
        $(".jifenneed").find(".yes").on("click", function() {
            $(".track_matte").hide();
            $(".jifenneed").hide();
            isUsingPoint = 1;
            zhuan($("#raffleid").val());
        });
        //话费积分抽奖  取消
        $(".jifenneed").find(".no").on("click", function() {
            $(".track_matte").hide();
            $(".jifenneed").hide();
        });

        var get_code = $(".maskContent").find(".get_code");
        //获取验证码
        get_code.on("click", function() {
            var mobile_number = $("#inp3jifen").val();
            getyzm(mobile_number, get_code)
        })
        $("#quxiao_btn").on("click", function() {
            $(".maskContent").hide();
            $(".track_matte").hide();
        })

        // 查看中奖
        $(".checkedJiang").on("click", function() {
            location.href = "shoporder.html";
        })

        //抽奖
        function roll(arr, prizeid, productid, prizetype, orderno) {
            luck.times += 1;
            luck.roll();
            if (luck.times > luck.cycle + 10 && luck.prize == luck.index) {
                console.log("times>cycle");
                clearTimeout(luck.timer);
                luck.prize = -1;
                luck.times = 0;

                //中奖提示
                setTimeout(function() {
                    click = 1;
                    console.log(click);
                    coloecss();
                    checkedMessage(prizeid, productid, prizetype, orderno);
                }, 1000);

            } else {
                if (luck.times < luck.cycle) {
                    luck.speed -= 10;
                } else if (luck.times == luck.cycle) {
                    var index = slice_arr(arr);
                    luck.prize = index;
                } else {
                    if (luck.times > luck.cycle + 10 && ((luck.prize == 0 && luck.index == 7) || luck.prize == luck.index + 1)) {
                        luck.speed += 110;
                    } else {
                        luck.speed += 20;
                    }
                }
                if (luck.speed < 40) {
                    luck.speed = 40;
                };
                luck.timer = setTimeout(function() {
                    roll(arr, prizeid, productid, prizetype, orderno);
                }, luck.speed);
            }
            return false;
        }

        // 抽奖转动
        function zhuan(raffleid) {
            if (click == 2) {
                // 当没转完的时候 再次点击的 时候无效
                return false;
            } else {
                var histroy = getH(raffleid);
                console.log(histroy);
                //是否满足抽奖条件
                var checkRaffleCondition_ = checkRaffleCondition(histroy);
                // alert(checkRaffleCondition_);
                if (!checkRaffleCondition_) {
                    return false;
                }
                //清空数组
                arr.splice(0, arr.length);
                //获取中奖位置
                var raffleInfo = getRaffleInfo_new(raffleid, uid, openid, mobile);

                if (raffleInfo.state != 0) {
                    return false;
                } else if (raffleInfo.state == 0) {
                    // var infotime=Date.parse(new Date());
                    var prizeid = raffleInfo.result.prizeId;
                    var orderno = raffleInfo.result.orderNo;
                    var productid = raffleInfo.result.productId;
                    var prizetype = raffleInfo.result.prizeType;
                }
                click = 2;
                addcss();
                luck.speed = 100;
                roll(arr, prizeid, productid, prizetype, orderno);
                return false;
            }
        }

        bindMobileNew();

        function bindMobileNew() {
            var true_ = $(".maskContent").find(".queding_btn");
            true_.on("click", function() {
                var mobile_number = $("#inp3jifen").val();
                var mobile_number_peo = $("#inp4jifen").val();
                var yzm = checkMobileAndSMSCode(mobile_number, mobile_number_peo);
                if (!yzm) {
                    alert("验证码错误")
                    return false;
                }
                var result = bindMobile(uid, mobile_number, mobile_number_peo);
                if (result.state != 0) {
                    alert(result.message);
                    return false;
                } else {
                    tishi("绑定成功！");
                    mobile = mobile_number;
                    $(".track_matte").hide();
                    $(".maskContent").hide();
                }
            });
        }

        // 获取奖品列表
        function getlist() {
            var prizeList = '';
            var cityinfo = {
                "cityId": cityid
            };
            var sendUrl = WX_URL + "HXXCServiceWeChat/raffle/getWebPrizeList";
            fnAjax(sendUrl, "get", false, cityinfo, function(data) {
                adddate(data);
            }, function(data) {});
        }

        // 添加动态数据
        function adddate(data) {
            // console.log(data)

            if (data.prizeTypeList != null && data.prizeTypeList.length != 0) {
                $(".wrap").show();
                // 渲染奖品列表
                $.each(data.prizeTypeList, function(i, k) {
                    $(".luck-unit-" + i).html('<span><img src=' + k.imageUrl + ' /></span>' + "<div class='tbBg'></div>");
                    //$(".luck-unit-" + i).html('<span>' + k.prizename + '</span>' + "<div class='tbBg'></div>");
                    $(".luck-unit-" + i).attr("_id", k.typeId);
                    $(".luck-unit-" + i).attr("prizeid", k.prizeId);
                    $(".luck-unit-" + i).attr("prizetype", k.prizetype);
                    $(".luck-unit-" + i).attr("productid", k.productid);
                });
                $("#point").html(data.raffleDetail.point);
                $("#raffleid").val(data.raffleDetail.raffleId);
                // 活动状态
                var state = "进行中";
                $(".start_time p").html("开始时间：" + data.raffleDetail.startDate.slice(0, data.raffleDetail.startDate.length - 5));
                $(".end_time p").html("结束时间：" + data.raffleDetail.endDate.slice(0, data.raffleDetail.endDate.length - 5));
                if (data.raffleDetail.status != 0) {
                    state = "结束";
                }
                $(".state_").html(state);
                $(".centenIntroduce p").html(data.raffledesc);
                // 中奖名单
                console.log(data);
                var arr_ = data.winnerList;
                var jiangListHtml = "";
                if (arr_.length < 4) {
                    $("#jiangList").css("top", "0px");
                    $("#con ul").pause(); //暂停动画
                    clearInterval(scrtime);
                }
                $.each(arr_, function(i, k) {
                    jiangListHtml += '<li>' + k.mobile + ' 抽中 ' + k.prizeName + '</li>';
                });
                $("#jiangList").html(jiangListHtml);

                //  奖品介绍
                addSwiperInfo(data.typeInfo);

                // 添加轮播图
                if (data.raffleImgList.length != 0) {
                    $(".img_gallery").show();
                    var imgHtml = '';
                    var pointHtml = '';
                    if (data.raffleImgList.length == 1) {
                        $(".img_gallery").html('<a href="' + data.raffleImgList[0].hrefurl + '&nohouse=' + nohouse + '" ><img src=' + data.raffleImgList[0].imgurl + ' /></a>')
                    } else {
                        $.each(data.raffleImgList, function(i, k) {
                            imgHtml += '<li><a href="' + k.hrefUrl + '"><span><img src=' + k.imgUrl + ' /></span></a></li>';
                            pointHtml += '<a href="#">' + i + '</a>';
                        });
                        $(".point").html(pointHtml);
                        $("#img_box").html(imgHtml);
                    }
                    setTimeout(function() {
                        var pointW = $(".point").width();
                        $(".point").css("margin-left", "-" + pointW / 2 + "px");
                    }, 10)
                }
            } else {
                $("html").css("background", "#fff");
                $("body").css("background", "#fff");
                $(".noData").show();
            }
        }
        //添加滑动结构 递归
        function addSwiperInfo(arr) {
            var html = "";
            if (arr.length <= 3) {
                $.each(arr, function(i, k) {
                    html += '<div class="prizeIntroduce_list">' +
                        '<div class="prize">' + k.typeName + '</div>' +
                        // '<div class="number">' + k.prizenum + '</div>' +
                        '<div class="img"><img src=' + k.prizeImage + ' /></div>' +
                        '<div class="money">' + k.prizeName + '</div>' +
                        '</div>';
                })
                var html_ = '<div class="swiper-slide">' + html + '</div>';
                $(".swiper-wrapper").append(html_);
            } else {
                var infoHtml = "";
                for (var i = 0; i < 3; i++) {
                    var infoHtml_ = arr.shift();
                    infoHtml += '<div class="prizeIntroduce_list">' +
                        '<div class="prize">' + infoHtml_.typeName + '</div>' +
                        // '<div class="number">' + infoHtml_.prizenum + '</div>' +
                        ' <div class="img"><img src=' + infoHtml_.prizeImage + ' /></div>' +
                        '<div class="money">' + infoHtml_.prizeName + '</div>' +
                        '</div>';
                }
                var html_ = '<div class="swiper-slide">' + infoHtml + '</div>';
                $(".swiper-wrapper").append(html_);
                addSwiperInfo(arr);
            }
        }

        //获取历史记录
        function getH(raffleid) {
            var result_ = '';
            var sendUrl = WX_URL + "HXXCServiceWeChat/raffle/getHistoryLottery";
            var sendData = {
                "uid": uid,
                "raffleId": raffleid
            };
            fnAjax(sendUrl, "get", false, sendData, function(data) {
                // console.log(data);
                result_ = data;
                //lotterynum      当日总抽奖次数
                //userlotterynum  用户已抽奖次数
                //userwinningnum  当日已中奖次数      如果  userwinningnum》=winningnum ；谢谢参与
                //winningnum      当日允许最大总中奖次数
                //freerafflenum   当日免费抽奖次数
            }, function(data) {});
            // console.log("获取历史记录");
            return result_;
        }

        function checkRaffleCondition(data) {
            console.log("checkRaffleCondition");
            console.log(data);
            if (parseInt(data.result[0].lotteryNum) <= parseInt(data.result[0].userLotteryNum)) {
                reminder_($(".shownumberDeil"), function() {});
                return false;
            }

            if (parseInt(data.result[0].freeRaffleNum) != -1) {
                // alert("有免费抽奖次数限制");
                //有免费抽奖次数限制
                if (parseInt(data.result[0].freeRaffleNum) <= parseInt(data.result[0].userLotteryNum)) {
                    // alert("花费积分抽奖");
                    // alert(isUsingPoint);
                    //花费积分抽奖
                    if (isUsingPoint == 1) {
                        var point_ = getUserPoint(uid, '');
                        console.log("point_" + point_);
                        // console.log(point_)
                        if (parseInt(point_) < parseInt(data.result[0].point)) {
                            //  alert("积分不足");
                            if (userMes.hasCard == 1) {
                                // alert("积分不足");
                                reminder_($(".no_jifen"), function() {
                                    // alert("进商城");
                                    location.href = "shopAll.html";
                                });
                            } else {
                                $(".active").show();
                                $(".track_matte").show();
                            }
                            return false;
                        } else {
                            return true;
                        }
                    } else {
                        $(".track_matte").show();
                        $(".jifenneed").show();
                        return false;
                    }
                } else {
                    return true;
                }
            } else {
                return true;
            }
            return true;
        }

        //获取 中奖商品
        function getRaffleInfo_new(raffleid, uid, openid, mobile) {
            var data_ = {
                "uid": uid,
                "openId": openid,
                "isUsingPoint": isUsingPoint,
                "raffleId": raffleid,
                "userMobile": mobile
            };
            var data = JSON.stringify(data_);
            var sendUrl = WX_URL + "HXXCServiceWeChat/raffle/getRaffleinfoNew";
            var state_end = (function(sendUrl, sendData) {
                var state = '';
                fnAjax(sendUrl, "post", false, sendData, function(data) {
                    state = data;
                    if (data.state == 0) {
                        $("#getJiang_text").html("恭喜您！获得 " + data.result.prizeName + " 奖品");
                        $("#getJiang_img").attr("src", data.result.prizeImage);
                        prizeid = data.result.prizeId;
                        typeid = data.result.typeId;
                        $.each($(".luck-unit"), function(i, k) {
                            if ($(k).attr("_id") == data.result.typeId) {
                                var n = $(k).attr("class");
                                if (n.indexOf(" active1") != -1) {
                                    var c = n.replace(" active1", "");
                                    n = c
                                }
                                arr.push(n)
                            };
                        });
                    } else {
                        console.log(data);
                        // window.location.reload();
                    }
                }, function(data) {});

                return state;
            })(sendUrl, data)
            isUsingPoint = 0;
            return state_end;
        }

        // 控制中奖位置
        function slice_arr(a) {
            // console.log(a);
            var new_index = [];
            for (var i = 0; i < a.length; i++) {
                var k = a[i].slice(-2);
                if (k.indexOf("-") != -1) {
                    //console.log("k"+k);
                    new_index.push(k.slice(-1));
                } else {
                    //console.log("kkkk"+k);
                    new_index.push(k);
                }
            }
            var index = Math.random() * new_index.length;
            var b = parseInt(index);
            // console.log("中奖位置： " + new_index[b]);
            return new_index[b];
        }

        //添加 点击抽奖 效果 背景 切换
        function addcss() {
            $(".tbBg").css("opacity", 0.8);
            $("#btn").addClass("cjBtnDom");
            setTimeout(function() {
                $("#btn").removeClass("cjBtnDom");
            }, 1000);
            $(".yaotop").hide();
            $(".yaobot").show();
        }

        //关闭 蒙层 背景
        function coloecss() {
            $(".tbBg").css("opacity", 0);
            $(".yaotop").show();
            $(".yaobot").hide();
        }

        var swiper = new Swiper('.swiper-container', {
            pagination: '.swiper-pagination',
            slidesPerView: 1,
            paginationClickable: true,
            spaceBetween: 0,
            freeMode: false
        });

        var i = getCookie("userlotterynum") || 1;
        // console.log(i);

        function checkedMessage(prizeid, productid, prizetype, orderNo) {
            //记录抽奖信息
            if (parseInt(prizeid) != 0) {
                if (parseInt(prizetype) == 1) { // 实物
                    $("#yesstate").html("补全地址");
                } else {
                    $("#yesstate").html("查看奖品");
                }
                reminder_($(".zhoangalert"), function() { //查看奖品
                    var isPrize = "1";
                    if (productid != "-") {
                        isPrize = 0;
                    }
                    // location.href = WX_URL + "user.php?dingdan_xiangqing=1&shangxun_orderNo=" + orderNo + "&producttype=" + prizetype + "&isPrize=" + isPrize;

                    if (prizetype == 1) { // 实物
                        location.href = "shopOrderDetailsCouponMetObject.html?shangxun_orderNo=" + orderNo + "&producttype=" + prizetype + "&isPrize=" + isPrize;
                    } else if (prizetype == 6) { // 优惠券
                        location.href = "shopOrderDetailsCoupon.html?shangxun_orderNo=" + orderNo + "&producttype=" + prizetype + "&isPrize=" + isPrize;
                    } else if (prizetype == 10) { // 虚拟
                        location.href = "shopOrderDetailsCouponFictitious.html?shangxun_orderNo=" + orderNo + "&producttype=" + prizetype + "&isPrize=" + isPrize;
                    }



                });
                return true;
            } else {
                var mesfont = "很遗憾！没有中奖！";
                if (i == 1) {
                    mesfont = "哎呀~再试一次~";
                } else if (i == 2) {
                    mesfont = "大奖已经很接近了~加油哦~";
                } else if (i == 3) {
                    mesfont = "离大奖越来越近啦~再接再厉~";
                } else if (i >= 4) {
                    //   alert(10);
                    mesfont = "很遗憾！没有中奖！";
                    i = 0;
                }
                $(".thankesalerttishi").html(mesfont);
                reminder_zhuan($(".thankesalert"), function() {});
                $(".track_matte").show();
                setCookie("userlotterynum", i++);
                console.log(i)
                return false;
            }
        }
        $("#activeQuxiao").on("click", function() {
            $(".track_matte").hide();
            $(".active").hide();
        })

        $("#activeQueding").on("click", function() {
            $(".track_matte").hide();
            $(".active").hide();
            window.location.href = '../memberCard/memberCenter.html';
            return false;
        })

        function getUserCardInfo() {
            var cardid = '';
            var hascard = '';
            $.ajax({
                url: WX_URL + 'requestAjax.php',
                type: 'POST',
                async: false,
                dataType: 'json',
                data: {
                    'identity': 'getDefaultCardId'
                },
                success: function(res) {
                    // console.log(res);
                    cardid = res.cardId;
                },
                error: function(res) {
                    // console.log(res)
                }
            })

            $.ajax({
                url: WX_URL + 'requestAjax.php',
                type: 'POST',
                async: false,
                dataType: 'json',
                data: {
                    "openid": openid,
                    "cardId": cardid,
                    'identity': 'getUserCardInfo'
                },
                success: function(res) {
                    // console.log(res);
                    hascard = res.hasCard;
                },
                error: function(res) {
                    // console.log(res)
                }
            })

            return hascard;
        }

        // 微信分享
        var share = {
            "shareTitle": "吃喝玩乐 华熙LIVE一卡通",
            "shareDesc": "花钱有积分，积分当钱花！",
            "shareLink": WX_URL + "weChat/shop/slyder_adventures.html",
            "posterImage": "https://melive.huaxiweiying.com/tmp/title.png",
        };
        wxShare(share, userMes.signPackage);

        //JS操作cookies方法!
        //写cookies
        function setCookie(name, value) {
            var Days = 30;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
            document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString();
        }

        function getCookie(name) {
            var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
            if (arr = document.cookie.match(reg))
                return unescape(arr[2]);
            else
                return null;
        }
        // console.log(getCookie("userlotterynum"));
        
    </script>
</body>

</html>
