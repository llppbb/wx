<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <!--禁止页面缩放-->
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
    <title>订单详情</title>
    <link rel="stylesheet" href="weixin/schedule/FontAwesome/css/simple.switch.three.css" type="text/css">
    <link rel="stylesheet" href="weixin/schedule/FontAwesome/css/css.css" type="text/css">
    <link rel="stylesheet" href="weixin/schedule/FontAwesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="weixin/schedule/css/zhifu.css">
    <link rel="stylesheet" href="weixin/schedule/css/common.css">
        <style>
            .shezhi_tishinew {
                /*width: 3rem;*/
                border-radius: 0.04rem;
                background: #000000;
                opacity: 0.7;
                position: fixed;
                padding: 0.07rem 0.14rem;
                left: 0px;
                top: 30%;
                color: #FFFFFF;
                text-align: center;
                display: none;
            }
            .deletebtn img{
                width: .11rem;
            }
            .seats{
                width: 90%;
                margin-left: 5%;
                margin-bottom: .1rem;
                padding: .13rem;
                background: #ffffff;
                position: relative;
            }

            .seatslist{
                margin-bottom: 0rem;
                font-size: .18rem;
                color: #333333;
            }
            .realNamelist{
                width: 100%;
                font-size: .14rem;
                color: #808080;
            }
            .line{
                width: 100%;
                height: 0.05rem;
                background: url(weixin/ticketfolder/pic/img_line.png) no-repeat;
                background-size: 100%;
                position: absolute;
                left: 0;
                top:-.13rem;
            }
           .sendstatus{
               padding:.15rem .28rem;
               background: url(weixin/ticketfolder/pic/img_bg.png) no-repeat;
               background-size: 100% 100%;
               margin-bottom: .1rem;
               color: #ffffff;
           }
           .wrap {
               padding-top: 0px;

           }
           .seasmoreImg{
               position: absolute;
               right: .14rem;
               top:50%;
               height: .12rem;
               margin-top: -0.06rem;
           }

           .iconfont{
               position: relative;
               padding-left: .2rem;
           }
           .iconimg{
               width: .13rem;
               position: absolute;
               left: 0rem;
               top: .03rem;
           }
           .status{
               position: absolute;
               right: .43rem;
               top: 50%;
               margin-top: -.1rem;
               color: #E8375E;
               background: #F8EBEE;
               padding: 0 .02rem;
               font-size: .10rem;
           }
        </style>
</head>

<body>
    <div class="wrap">
        <div class="sendstatus" style="display:none"></div>
        <div class="addressmes" style="display:none">
        </div>
        <div class="personmobile spaceBetween borrad" style="margin-bottom:.1rem">
            <div>购票人手机号</div>
            <div><?php echo $mobile?></div>
        </div>
        <div class="seatsbox borrad"></div>
        <div class="titcketmes borrad">
            <div class="tmproduct bordas">
                <div class="productName"></div>
                <div class="productTime"></div>
            </div>
            <div class="tmNumMoney spaceBetween bordas">
                <div class="fontL ticketCount"></div>
                <div class="tmMoney payAmount"></div>
            </div>
            <div class="tmsendtype spaceBetween bordas">
                <div class="fontL">快递费</div>
                <div><span class="freight" style="color:#E8375E;font-size:.14rem;"></span>元</div>
            </div>
            <div class="tmsendtype spaceBetween bordas">
                <div class="fontL">积分抵扣</div>
                <div><span class="payPoint" style="color:#E8375E;font-size:.14rem;"></span>元</div>
            </div>
            <div class="tmsendtype spaceBetween">
                <div class="fontL">实付款</div>
                <div><span id="totalAmout" style="color:#E8375E;font-size:.14rem;"></span>元</div>
            </div>
        </div>
    </div>

    <script src="weixin/common/jquery.js"></script>
    <script src="weixin/common/fontSize.js"></script>
    <script src="weixin/common/common.js?v=<?php echo date('YmdHis')?>"></script>
    <script type="text/javascript" src="https://pingjs.qq.com/h5/stats.js" name="MTAH5" sid="500338441"></script>
    <!--修改-->
    <script>
        var uid = "<?php echo $uid?>";
        // var uid = "2017541475479";
        // var uid = "2016001061205";
        var openId = "<?php echo $openid?>";
        var orderNo = "<?php echo $orderNo?>";
        var ticketType = 0;
        var realNameStatus = "";
        getTicketOrderDetail(uid,orderNo);
        function getTicketOrderDetail(uid,orderNo){
            $.ajax({
                    url: WX_URL + 'requestAjax.php',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        'uid': uid,
                        'orderNo': orderNo,
                        'identity': 'getTicketOrderDetail'
                   },
                    async:false,
                    success:function(data){
                        console.log(data);
                        $(".productName").html(data.result.cnName);
                        $(".productTime").html(data.result.playTime);
                        $(".ticketCount").html('<span style="color:#E8375E;font-size:.14rem;">'+data.result.ticketNumber+'</span>'+"张");
                        $(".payAmount").html('<span style="color:#E8375E;font-size:.14rem;">'+data.result.totalAmount+'</span>'+"元");
                        $(".freight").html(data.result.freight);
                        $(".payPoint").html(data.result.orderDeduction? data.result.orderDeduction :  0);
                        // 实际支付金额
                        $("#totalAmout").html(data.result.payAmount);
                        var isShowType="zhizhi";
                        var sendhtml="";
                       if(data.result.ticketType==0){  //纸质票
                          if(data.result.isShowQrCode){  // 是否显示二维码  0：二维码  1：地址
                              if(data.result.ticketOrderAddress){
                                  $(".addressmes").show();
                                  var html='<div class="hasaddress" style="position:relative;">'+
                                  '<div class="line"></div>'+
                                  '<div class="addressNmae iconfont">收货人：<span>'+data.result.ticketOrderAddress.name+' </span><img src="weixin/schedule/pic/icon_person.png" class="iconimg"/></div>'+
                                  '<div class="addressMobile iconfont">收货人手机号：<span>'+data.result.ticketOrderAddress.mobile+'</span><img src="weixin/schedule/pic/icon_telephone.png" class="iconimg"/></div>'+
                                  '<div class="addressDetailed iconfont">收货人地址：<span>'+data.result.ticketOrderAddress.address+'</span><img src="weixin/schedule/pic/icon_addressIcon.png" class="iconimg"/></div>'+
                                  '</div>';
                                  var sendstatus='';
                                  if(data.result.ticketOrderAddress.status==0){
                                      sendstatus="待发货"
                                  }else if(data.result.ticketOrderAddress.status==1){
                                      sendstatus="已发货"
                                  }else if(data.result.ticketOrderAddress.status==2){
                                      sendstatus="签收"
                                  }
                                 var ticketOrderAddress='<span style="margin-right:.1rem">'+data.result.ticketOrderAddress.expressName+'</span><span>'+data.result.ticketOrderAddress.expressNo+'</span>';
                                  if(data.result.ticketOrderAddress.status==0){
                                        ticketOrderAddress="暂无物流信息";
                                  }
                                   sendhtml='<div class="hasaddress">'+
                                  '<div class="addressNmae"><span style="font-size:.18rem;color:#FFDD10;margin-right:.2rem">'+sendstatus+'</span><span  style="background:#A7ACBE;font-size:.13rem;line-height:.2rem;padding-left:.05rem;padding-right:.05rem;border-radius:.02rem">'+ticketOrderAddress+'</span></div>'+
                                  '</div>';
                                 $(".addressmes").html(html);
                              }
                          }
                      }else if(data.result.ticketType==1) { //电子票
                          isShowType="dianzi";
                      }
                      $(".sendstatus").show();

                      var orderTime=timestampToTime(data.result.orderTime,"y-m-d h:m");
                      console.log(orderTime);
                      var sendhtml='<div class="hasaddress">'+sendhtml+
                      '<div class="addressMobile">订单号：<span>'+orderNo+'</span></div>'+
                      '<div class="addressDetailed">下单时间：<span>'+orderTime+'</span></div>'+
                      '</div>';
                      $(".sendstatus").html(sendhtml);
                       var allhtml="";
                       var realname='';
                       var seatshtml='';
                    // realNameStatus  1实名制  0非实名制
                    // realNameType  1一票一证  0一单一证
                     var showqrcode='';
                         if(isShowType=="dianzi"){
                                showqrcode=0;
                         }else{
                             showqrcode=data.result.isShowQrCode;
                         }
                     $.each(data.result.ticketLockInfoIdCards,function(i, k) {

                         //  isShowQrCode 是否显示二维码  0：二维码（点击可以跳转到 二维码页面）  1：地址
                        //  判断实名制信息
                         if(data.result.realNameStatus==1){
                             realname='<div class="realNamelist spaceBetween">'+
                               '<div>'+k.price+'元</div>'+
                               '<div style="padding-right: .2rem;">证件号：'+k.idCard+'</div>'+
                             '</div>';
                         }else{
                             realname='<div class="realNamelist spaceBetween">'+
                               '<div>'+k.price+'元</div>'+
                             '</div>';
                         }
                         if(data.result.canChooseSeat==1 || data.result.ticketType==1){  //canChooseSeat 1 选座 0 自动分配 （纸质票的自动分配不展示座位信息）
                            //  判断是否显示座位信息  展示座位(所有选座的和电子票的都展示座位信息)
                            seatshtml='<div class="seatslist">'+
                            '<span style="margin-right:.1rem;font-size:.18rem;color:#333333">'+k.venueAreaName+'</span>'+
                            '<span style="font-size:.18rem;color:#333333;">'+k.lineno+'排</span>'+
                            '<span style="font-size:.18rem;color:#333333">'+k.rankno+'座</span></div>';
                         }
                         var morebtn='';
                         var statushtml="";
                         if(showqrcode==0){
                             //  判断票状态
                             if(data.result.ticketType==1 && k.status==1){   //电子票 已使用
                                 statushtml="<div class='status'>已使用</div>";
                             }else if(data.result.ticketType==0 && k.status==1) {  //纸质票 已兑换
                                 statushtml="<div class='status'>已兑换</div>";
                             }else if(data.result.ticketType==0 && k.status==2) {  //纸质票 不可用
                                 statushtml="<div class='status'>不可用</div>";
                             }
                            morebtn='<img src="weixin/ticketfolder/pic/gengduo.png" class="seasmoreImg"/>'
                         }
                         allhtml='<div class="seats" idx="'+i+'" isShowQrCode='+showqrcode+'>'+seatshtml+realname+morebtn+statushtml+'</div>'
                         $(".seatsbox").append(allhtml);
                     });
                    }
                })
        }

       $(".seats").on("click",function(){
           /** 是否显示二维码 	 0：二维码  1：地址  	private Integer isShowQrCode;*/
           var idx=$(this).attr("idx");
           var isShowQrCode=$(this).attr("isShowQrCode");
           if(isShowQrCode==0){
               location.href = WX_URL + "user.php?ticketParticulars=1&idx=" + idx+"&orderNo=" + orderNo ;
           }
       })
       // 禁用微信分享
             function onBridgeReady() {
                    WeixinJSBridge.call('hideOptionMenu');
               }

              if (typeof WeixinJSBridge == "undefined") {
                  if (document.addEventListener) {
                      document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
                  } else if (document.attachEvent) {
                      document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
                      document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
                  }
              } else {
                  onBridgeReady();
              }
    </script>
</body>

</html>
