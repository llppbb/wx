<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <!--禁止页面缩放-->
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
    <title>商城</title>
    <link rel="stylesheet" href="weixin/shop/css/shop_zhuye.css">
    <script src="weixin/common/jquery.js"></script>
    <script src="weixin/common/fontSize.js"></script>
    <script src="weixin/common/common.js"></script>
    <script src="weixin/common/md5.js"></script>
    <script src="weixin/shop/js/common.js"></script>
    <script type="text/javascript" src="https://pingjs.qq.com/h5/stats.js" name="MTAH5" sid="500338441"></script>
</head>
<style>
    .xianshi p span {
        background: url(./weixin/shop/pic/icon_limit_pre.png) no-repeat;
        background-size: 100% 100%;
    }

    .quanbu p span {
        background: url(./weixin/shop/pic/icon_all.png) no-repeat;
        background-size: 100% 100%;
    }

    .tanchuang_p {
        text-align: left !important;
        padding: 0.1rem;
        margin-bottom: 0.1rem;
    }

    .title_wenzi {
        text-align: center !important;
        margin-bottom: 0.2rem !important;
    }

    /*没有商品是展示*/

    .nodata {
        display: none;
        margin-top: .95rem;
        text-align: center;
        font-size: .15rem;
        color: rgb(51, 51, 51);
    }

    .nodata img {
        width: 40%;
    }

    .nodata p {
        margin-top: .25rem;
    }
</style>

<body>
    <div class="wrap">
        <header class="head_zhuye">
            <div class="xianshi">
                <p class="tabOn"><span></span>限时抢购</p>
            </div>
            <div class="quanbu" id="allshop_btn">
                <p><span></span>全部商品</p>
            </div>
        </header>
        <section>
            <div class="jinxian" id="lingqu_btn">
                <div class="jinxian_wenzi">领取规则</div>
                <div class="jinxian_tupian"></div>
            </div>
            <div class="centen_img"></div>
        </section>
        <div class="nodata">
            <img src="weixin/shop/pic/img_empty.png" />
            <p>商城商品正加紧更新中...</p>
        </div>
    </div>

    <script>
        $("#lingqu_btn").on("click", function() {
            getrulesFun();
        })

        var sendUrl = COUPON_URL + "Home/Requestajax/getExplosionGoodsList";
        var sendData = {
            "sign": md5_sign_tmp,
            "timestamp": tmp
        }
        fnAjax(sendUrl, sendData, function(data) {

            var centen_html = "";
            var centen_html_new = "";
            var name = '';
            window.arr = [];
            if (data.result.length == 0) {
                $(".nodata").show();
                return false;
            }
            $.each(data.result, function(i, k) {
                if (i > 2) {
                    return false;
                }
                // 判断是有商品描述有就限时商品描述没有就显示商品名称
                var n = judge_productDesc(k, name);
                //  限时爆款 结构
                centen_html_new += add_html(centen_html, n, k);
            });
            $(".centen_img").append(centen_html_new);
        }, null);



        /*控制 状态条  (免费   钱+金币、积分)*/
        function posL(name) {
            var centen_img_list_state_w = $(name).innerWidth();
            var centen_img_list_w = $(".centen_img_list").innerWidth();
            var posL = (centen_img_list_w - centen_img_list_state_w) / 2;
            //alert(name);
            $(name).css({
                "left": posL
            })
        };
        posL(".centen_img_list_state_mianfei");
        posL(".centen_img_list_state_fufei");

        //添加大的 背景图片
        setTimeout(function() {
            for (var i = 0; i <= arr.length - 1; i++) {
                var img_index = arr[i];
                $(".centen_img_list").eq(i).css({
                    "background": "url(" + img_index + ") no-repeat",
                    "background-size": "100% 100%"
                })
            }
            // /*进入详情页*/
            infor(".in_xiangqing_btn", "productid", WX_URL + "user.php?xiangqing=1")
        }, 1000)
        /*进入 全部商品 */
        infor("#allshop_btn", null, WX_URL + "user.php?shop=1");

        // 判断是否 还有商品描述 有的话 显示 商品描述 没有的 就  显示商品的 名称
        function judge_productDesc(k, name) {
            if (k.productimagedesc != "-") {
                name = k.productimagedesc;
            } else {
                name = k.productname;
            }
            return name;
        }

        function add_html(centen_html, n, k) {
            centen_html += '<div class="centen_img_list in_xiangqing_btn" attr_name="' + k.productid + '"><div class="centen_img_list_mengceng"></div>' +
                '<div class="centen_img_list_mengceng_top">' +
                '<div class="centen_img_list_small_img"><img src="' + k.productlogo + '"/></div>' +
                '<div class="centen_img_list_wenzi">' + n + '</div>';
            // 判断是否 免费
            if (k.exchangetype == 0) {
                //alert("mianfei");
                centen_html += '<div class="canyin_list_state canyin_list_state_mianfei">免费</div>' +
                    '</div>' +
                    '</div>';
            } else if (k.exchangetype == 1) {
                centen_html += '<div class="canyin_list_state  canyin_list_state_jifen">' + k.point + '积分</div>' +
                    '</div>' +
                    '</div>'
            } else if (k.exchangetype == 2) {
                centen_html += '<div class="canyin_list_state  canyin_list_state_jifen">' + k.price + '元</div>' +
                    '</div>' +
                    '</div>'
            }
            //  console.log(centen_html);
            arr.push(k.productimage);
            return centen_html;
        }

        // 抽奖页面入口
        // infoSlyder();

        goHomeBtn("body");
    </script>
</body>

</html>
