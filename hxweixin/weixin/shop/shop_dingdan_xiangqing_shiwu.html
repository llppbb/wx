<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <!--禁止页面缩放-->
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
    <title>订单详情</title>
    <link rel="stylesheet" type="text/css" href="weixin/shop/css/dingdanxiangqing.css" />
    <link rel="stylesheet" type="text/css" href="weixin/shop/css/common.css" />
    <link rel="stylesheet" type="text/css" href="weixin/shop/css/dingdanxiangqing_butong.css" />
</head>
<style>
    .addAddress {
        width: 100%;
        height: .6rem;
        background: #fff;
        margin-top: .1rem;
        margin-bottom: .1rem;
    }

    .addAddress p:nth-of-type(1) {
        float: left;
        margin-top: .1rem;
    }

    .addAddress p:nth-of-type(2) {
        float: right;
    }

    .addressBtn {
        width: 1rem;
        text-align: center;
        line-height: .3rem;
        background: rgb(255, 221, 16);
        border-radius: .2rem;
        margin-top: .15rem;
        margin-right: .1rem;
    }
    /*绑定 手机   开始    大盒子  */

    .bindmobile {
        width: 86%;
        margin-top: 1rem;
        margin-left: 7%;
        position: fixed;
        z-index: 555;
        border-radius: 0.14rem;
        overflow: hidden;
        text-align: center;
        left: 0px;
        top: 0px;
        background: rgb(255, 255, 255);
        padding-bottom: 0.2rem;
        display: none;
    }
    /*上边的标题*/

    .bmtitle {
        font-size: 0.18rem;
        color: rgb(51, 51, 51);
        padding-top: 0.155rem;
    }
    /*包含 手机号 验证码 盒子 */

    .bmboxT {
        position: relative;
    }
    /*输入手机号*/

    .bmmobilenum {
        width: 87%;
        height: 0.57rem;
        border: 1px solid rgb(227, 227, 227);
        margin-top: 0.19rem;
        text-indent: 10px;
        position: relative;
        display: inline-block;
    }
    /*获取验证码*/

    .bmgetCode {
        display: inline-block;
        width: 1.015rem;
        height: 0.25rem;
        font-size: 0.14rem;
        text-align: center;
        line-height: 0.25rem;
        color: rgb(51, 51, 51);
        border: 1px solid rgb(255, 211, 16);
        position: absolute;
        border-radius: 0.50rem;
        z-index: 10;
        top: 0.35rem;
        left: 1.80rem;
        background: #ffffff;
    }
    /*验证码 车牌号*/

    .bmauthcCode,
    .bmcar {
        width: 87%;
        height: 0.57rem;
        border: 1px solid rgb(227, 227, 227);
        text-indent: 10px;
        border-top: none;
    }
    /*提示文字*/

    .bmpromptText {
        width: 87%;
        color: rgb(185, 185, 185);
        font-size: .12rem;
        margin: 0 auto;
        margin-top: .05rem;
        margin-bottom: .2rem;
        text-align: left;
    }
    /*两个 按钮的盒子*/

    .bmboxB {
        width: 100%;
        margin-top: .2rem;
        border-top: 1px solid rgb(230, 230, 230);
    }
    /*取消 按钮*/

    .bmabolish {
        display: inline-block;
        width: 1.20rem;
        height: 0.40rem;
        text-align: center;
        line-height: 0.40rem;
        border-radius: 0.50rem;
        border: 1px solid rgb(255, 221, 16);
        font-size: 0.16rem;
        color: rgb(51, 51, 51);
        margin-top: 0.20rem;
    }
    /*确定 按钮*/

    .bmconfirm {
        display: inline-block;
        width: 1.20rem;
        height: 0.40rem;
        text-align: center;
        line-height: 0.40rem;
        border-radius: 0.50rem;
        background: rgb(255, 221, 16);
        font-size: 0.16rem;
        color: rgb(51, 51, 51);
        margin-top: 0.20rem;
        margin-left: 0.22rem;
    }
    /*绑定手机 结束*/

    .mengceng {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: #000000;
        opacity: 0.7;
        display: none;
    }



    .trueads {
        border: 1px solid rgb(255, 221, 16);
        color: rgb(51, 51, 51);
    }

    .noshowads {
        border: 1px solid rgb(198, 198, 198);
        color: rgb(198, 198, 198);
    }

    .rightfu {
        position: absolute;
        right: .14rem;
        width: .07rem;
        top: 50%;
        margin-top: -.14rem;
    }

    .rightfu img {
        width: 100%;
    }
    /*remarks*/
    .remarks{
        display: none;
       background: #fff;
       margin-top: .1rem;
       padding: .14rem;
    }
    .remarksText{
        font-size: .14rem;
        line-height: .25rem;
    }
    .remarksFont{
        font-size: .16rem;
        color: rgb(51, 51, 51);
        margin-bottom: .14rem;
    }

    .peisongtype{
        display: none;
        background: #fff;
        font-size: .14rem;
        color: rgb(51, 51, 51);
        line-height: .45rem;
        padding-left: .14rem;
    }

    .shangpinxinxi_number{
        position: relative;
    }
    .noneedads {
        width: 1rem;
        height: .33rem;
        text-align: center;
        line-height: .33rem;
        font-size: .16rem;
        border-radius: .2rem;
        position: absolute;
        right:  .14rem;
        top: .07rem;
    }
</style>

<body>
    <div class="wrap">
        <div class="shangpinxinxi">
            <div class="shangpinxinxi_name_number">
                <div class="shangpinxinxi_name font_16_color_51  border_bottom">
                    <p id="productname"></p>
                    <p id="producttime" style="font-size:.15rem;color:rgb(128,128,128);margin-top:.14rem;margin-bottom:.14rem;"></p>
                    <!-- <div class="rightfu"><img src="/weixin/shop/pic/gengduo.png" /></div> -->
                </div>
                <div class="shangpinxinxi_number font_14_color_128">
                    数量：
                    <span class="color_233" id="number"></span> 件
                    <!-- 无需添加地址 -->
                    <div class="noneedads" style="display:none">确认领取</div>
                    <!-- <div class="noneedads trueads">确认领取</div> -->
                </div>

            </div>
        </div>

        <!-- <div class="peisongtype">配送方式：快递</div>
         -->
        <div class="addAddress" style="display:none">
            <p class="peisong_xinxi_wenzi">配送信息:无</p>
            <p class="addressBtn">填写收货信息</p>
        </div>
        <div class="peisong">
            <div class="peisong_xinxi bor_bottom font_14_color_51" id="hasaddress" style="display:none">
                <p class="peisong_xinxi_wenzi">配送信息</p>
                <p class="peisong_xinxi_lianxiern">
                    <span class="peisong_xinxi_lianxiern_name" id="name"></span>
                    <span class="peisong_xinxi_lianxiern_mobile" id="mobile"></span>
                </p>
                <p class="peisong_xinxi_adress font_14_color_128" id="address"></p>
            </div>

            <div class="peixong_state">
                <div>配送状态：<span id="sendState"></span></div>
                <div>物流信息：<span id="sendType"></span></div>
            </div>
        </div>

        <div class="danhaoshijian_xiaohao">
            <div class="danhaoshijian bor_bottom">
                <p class="font_14_color_51">订单号：<span id="danhao"></span></p>
                <p class="font_14_color_51" id="jingpaihide">下单时间：<span id="time"></span></p>
            </div>
            <div class="xiaohao font_14_color_51">
                <!-- <div class="xiaohao_jinbi">
                        <p>金币小号</p>
                        <p class="xiaohao_erdu">0金币</p>
                    </div>
                    <div class="xiaohao_jifen">
                        <p>积分消耗</p>
                        <p class="xiaohao_erdu">0金币</p>
                    </div> -->
                <div class="xiaohao_shifukuan">
                    <p>实付款</p>
                    <p class="xiaohao_erdu font_14_color_233" id="money">0</p>
                </div>
            </div>
        </div>

        <div class="remarks">
            <p class="remarksFont">温馨提示</p>
            <p class="remarksText"></p>
        </div>
    </div>

    <!--绑定手机及车牌号-->
    <div class="bindmobile">
        <p class="bmtitle">收货信息</p>
        <div class="bmboxT">
            <input type="text" class="bmmobilenum" placeholder="收货人姓名">
        </div>
        <input type="number" class="bmauthcCode" placeholder="收货人手机号">
        <input type="text" class="bmcar" placeholder="收货人地址">
        <p class="bmpromptText">友情提示：请尽快完善信息，方便给您邮寄奖品。</p>
        <div class="bmboxB">
            <div class="bmabolish" id="quxiao_btn">取消</div>
            <div class="bmconfirm">确定</div>
        </div>
    </div>

    <div class="mengceng"></div>
    <script src="weixin/common/jquery.js"></script>
    <script src="weixin/common/fontSize.js"></script>
    <script src="weixin/common/common.js"></script>
    <script src="weixin/common/md5.js"></script>
    <script src="weixin/shop/js/common.js"></script>
    <script type="text/javascript" src="https://pingjs.qq.com/h5/stats.js" name="MTAH5" sid="500338441"></script>
    <script>
        var tmp = Date.parse(new Date()).toString();
        tmp = tmp.substr(0, 10);
        var sign_tmp = "SDE45FHW6KL" + tmp;
        var md5_sign_tmp = hex_md5(sign_tmp);
        var uid = "<?php echo $uid?>";
        var shangxun_orderNo = "<?php echo $shangxun_orderNo?>";
        var productid = "<?php echo $productid?>";
        var isPrize = "<?php echo $isPrize?>";
        var ordertype = "<?php echo $ordertype?>";
        var nohouse="<?php echo $nohouse?>";
        if(nohouse!=1){
            // 返回  商城 主页
            goHomeBtn('body');
        }
        if (ordertype == 2) {
            $.ajax({
                url: WX_URL + 'requestAjax.php',
                type: 'POST',
                dataType: 'json',
                data: {
                    'uid': uid,
                    'orderID': shangxun_orderNo,
                    'identity': 'getAuctionOrderDetail'
                },
                success: function(data) {
                    console.log(data);
                    var data = data.result;
                    $("#productname").html(data.name);
                    $("#number").html(data.amount);
                    $("#name").html(data.receName);
                    $("#address").html(data.receAddress);
                    $("#mobile").html(data.receMobile);
                    var sendState = '';
                    if (data.status == 0) {
                        sendState = "待发货"
                    } else if (data.status == 1) {
                        sendState = "已发货"
                    } else if (data.status == 2) {
                        sendState = "签收"
                    }
                    $("#sendState").html(sendState);
                    if(data.deliverCompaney==null &&  data.deliverID==null){
                        $("#sendType").html("暂无");
                    }else{
                        $("#sendType").html(data.deliverCompaney + data.deliverID);
                    }
                    $("#danhao").html(data.orderID);
                    var newtime = data.time.substring(0, 16);
                    console.log(newtime)
                    $("#time").html(newtime);
                    $("#producttime").html("竞拍时间：" + newtime);
                    // var payInfo = data.price + " 积分";
                    $(".xiaohao").hide();
                    $("#jingpaihide").html("竞拍价：<span class='font_14_color_233'>" + data.price + "</span> 积分");
                    if (data.receName == null || data.receAddress == null || data.receMobile == null) {
                        $("#hasaddress").hide();
                        $(".addAddress").show();
                    } else {
                        $("#hasaddress").show();
                        $(".addAddress").hide();
                    }
                    // $("#money").html(payInfo); 1  不需要地址
                    if (data.needReceInfo == 1) {
                        $(".peisong").hide();
                        $(".addAddress").hide();
                        $(".noneedads").show();
                        // useStatus  0 确认领取（可点击状态）  1 已领取
                        var lingfont = '';
                        var lingclass = '';
                        if (data.useStatus == 0) {
                            lingfont = '确认领取';
                            lingclass = "trueads";
                        } else if (data.useStatus == 1) {
                            lingfont = '已领取';
                            lingclass = "noshowads";
                        } else if (data.useStatus == 2) {
                            lingfont = '已过期';
                            lingclass = "noshowads";
                        }
                        $(".noneedads").html(lingfont);
                        $(".noneedads").addClass(lingclass);
                    }else{
                        // 需要地址
                        var lingfont = '';
                        var lingclass = '';
                        if (data.useStatus == 2) {
                            lingfont = '已过期';
                            lingclass = "noshowads";
                        }
                        $(".noneedads").html(lingfont);
                        $(".noneedads").addClass(lingclass);
                    }

                    $(".trueads").on("click", function() {
                        twoanniu("您确定已领取到商品吗？", "取消", "确定");
                    })
                    // 显示温馨提示
                    console.log(data.remarks);
                    if(data.remarks!=null){
                       $(".remarks").show();
                       $(".remarksText").html(data.remarks);
                    }
                }
            });
        } else {
            $.ajax({
                type: "post",
                url: COUPON_URL + "Home/Requestajax/getOrderInfoDetail",
                async: false,
                dataType: "json",
                data: {
                    "sign": md5_sign_tmp,
                    "timestamp": tmp,
                    "uid": uid,
                    "orderNo": shangxun_orderNo,
                    "isPrize": isPrize
                },
                success: function(data) {
                    var data = data.result;
                    console.log(data);
                    $("#productname").html(data.productname);
                    $("#number").html(data.buynumber);
                    $("#name").html(data.addressInfo.name);
                    $("#address").html(data.addressInfo.address);
                    $("#mobile").html(data.addressInfo.mobile);
                    var sendState = '';
                    if (data.addressInfo.status == 0) {
                        sendState = "待发货"
                    } else if (data.addressInfo.status == 1) {
                        sendState = "已发货"
                    } else if (data.addressInfo.status == 2) {
                        sendState = "签收"
                    }
                    $("#sendState").html(sendState);
                    $("#sendType").html(data.addressInfo.expressname + data.addressInfo.expressno);
                    $("#danhao").html(data.orderno);
                    var newtime = data.ordertime.substring(0, 16);
                    $("#time").html(newtime);
                    if (data.paytype == 7) {
                        $("#producttime").html("抽奖时间：" + newtime);
                    } else {
                        $("#producttime").html("兑换时间：" + newtime);
                    }
                    var payInfo = 0;
                    if (data.exchangetype == 1) {
                        // 积分
                        console.log(data.point);
                        payInfo = data.point * 1 * data.buynumber * 1 + " 积分";
                    } else if (data.exchangetype == 2) {
                        // 现金
                        payInfo = data.price * 1 * data.buynumber * 1 + " 元"
                    } else if (data.exchangetype == 99) {
                        // 现金

                        payInfo = "抽奖";
                    }
                    if (data.addressInfo.name == "-" || data.addressInfo.mobile == "-" || data.addressInfo.address == "-") {
                        $("#hasaddress").hide();
                        $(".addAddress").show();
                    } else {
                        $("#hasaddress").show();
                        $(".addAddress").hide();
                    }

                    $("#money").html(payInfo);
                },
                error: function() {
                    alert("错误")
                }
            });
        }

        $(".bmabolish").on("click", function() {
            $(".bindmobile").hide();
            $(".mengceng").hide();
        })

        $(".bmconfirm").on("click", function() {

            if ($(".bmmobilenum").val().trim() == '' || $(".bmcar").val().trim() == '' || $(".bmauthcCode").val().trim() == '') {
                alert("请完善信息！");
                return false;
            }

            var name = $(".bmmobilenum").val().trim();
            var address = $(".bmcar").val().trim();
            var mobile = $(".bmauthcCode").val().trim();
            var winnerId = "<?php echo $shangxun_orderNo?>";

            if (!(/^1[34578]\d{9}$/.test(mobile))) {
                alert("请输入正确的手机号");
                return false;
            }
            console.log(name + mobile + address + winnerId);
            var data_ = {
                "winnerId": winnerId,
                "name": name,
                "mobile": mobile,
                "address": address
            };
            var data = createSign(data_);
            if (ordertype == 2) {
                $.ajax({
                    url: WX_URL + 'requestAjax.php',
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        'uid': uid,
                        'orderID': shangxun_orderNo,
                        'identity': 'addReceiptInfo',
                        "receAddress": address,
                        "receName": name,
                        "receMobile": mobile
                    },
                    success: function(data) {
                        console.log(data);
                        $(".bindmobile").hide();
                        $(".mengceng").hide();
                        window.location.reload();
                    }
                });
            } else {

                $.ajax({
                    type: "post",
                    url: COUPON_URL + "Home/Requestajax/updateWinnerUserInfo",
                    async: false,
                    dataType: "json",
                    data: data,
                    success: function(data) {
                        console.log(data);
                        $(".bindmobile").hide();
                        $(".mengceng").hide();
                        window.location.reload();
                    },
                    error: function() {}
                })
            }

        })

        $(".addressBtn").on("click", function() {
            $(".mengceng").show();
            $(".bindmobile").show();
        })

        // $(".rightfu").on("click", function() {
        //     // 跳传竞拍详情
        //     location.href = WX_URL + "weixin/game/hxauction/index.html?action=viewdetail&auctionID=1a16b831fbb34038af1bb8a3390dadd0";
        // })

        function twoanniu(centen_wenzi, anniu_wenziL, anniu_wenziR) {
            var tishikuang_html = "<div class='twoanniuBox' style='width: 100%;height: 100%;background: #000000;opacity: .7;position: fixed;left: 0px;top: 0px;'></div>" +
                "<div class='twoanniuBox' style='width: 90%;height: 2rem;position: fixed;background: #ffffff; border-radius: 0.04rem; left: 5%;top: 0.69rem;z-index:500'><div style='padding-bottom: 0.36rem;padding-top: 0.6rem;text-align: center;border-bottom: 1px solid rgb(230,230,203);color: rgb(51,51,51);font-size: 0.16rem;'>" +
                centen_wenzi +
                "</div><div style='margin:0.2rem 0 ;width: 40%;float:left;margin-left: 7%;height: 0.4rem;border:1px solid rgb(255,221,16);border-radius: 0.2rem;font-size: 0.16rem;color: rgb(51,51,51);text-align: center;line-height: 0.4rem;' id='falsebtn'>" +
                anniu_wenziL +
                "</div><div style='margin:0.2rem 0 ;width: 40%;margin-right: 7%;height: 0.4rem;background: rgb(255,221,16);border-radius: 0.2rem;font-size: 0.16rem;color: rgb(51,51,51);text-align: center;line-height: 0.4rem; float:right;' id='truebtn'>" +
                anniu_wenziR + "</div></div>";
            $("body").append(tishikuang_html);
            $("#falsebtn").on("click", function() {
                $(".twoanniuBox").remove();
                $(".erweima_tishi").show();
            })
            $("#truebtn").on("click", function() {
                $(".twoanniuBox").remove();
                $(".erweima_tishi").show();
                updateOrderUseStatus();
            })
        }



        function updateOrderUseStatus() {
            console.log(shangxun_orderNo);
            $.ajax({
                url: WX_URL + 'requestAjax.php',
                type: 'POST',
                dataType: 'json',
                data: {
                    'uid': uid,
                    'orderID': shangxun_orderNo,
                    'identity': 'updateOrderUseStatus'
                },
                success: function(data) {
                    console.log(data);
                    window.location.reload();
                }
            })
        }

        // twoanniu("您确定已领取到商品吗？", "取消", "确定");
    </script>
    </script>

</body>

</html>
