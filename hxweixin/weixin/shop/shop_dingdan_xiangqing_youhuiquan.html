<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=yes" />
    <meta name="format-detection" content="email=no" />
    <title>订单详情</title>
    <link rel="stylesheet" type="text/css" href="weixin/shop/css/common.css" />
    <link rel="stylesheet" type="text/css" href="weixin/common/common.css" />
    <link rel="stylesheet" type="text/css" href="weixin/shop/css/dingdanxiangqing.css" />
    <style>
        .shangpinxinxi_erweima {
            padding-bottom: 0px;
            width: 100%;
        }

        .erweima_tupian {
            width: 100%;
            height: 0.45rem;
            margin-top: 0.1rem;
            line-height: 0.45rem;
            background: #ffffff;
            padding-left: 0.14rem;
            position: relative;
        }

        .img_state {
            width: 0.5rem;
            height: 0.5rem;
            position: absolute;
            right: 0.14rem;
            bottom: 0rem;
        }

        .img_state img {
            margin-bottom: 0px;
        }

        .shangpinxinxi_youxianqi {
            padding-bottom: 0.14rem;
            margin-bottom: 0px;
        }

        /*点击 电话 图标  显示 */

        .mobile_html {
            width: 90%;
            position: fixed;
            bottom: -5rem;
            left: 5%;
            text-align: center;
            z-index: 50;
        }

        .mobile_html div {
            line-height: 0.48rem;
            border-radius: 0.04rem;
            background: #FFFFFF;
            font-size: 0.15rem;
        }

        .mobile_number {
            margin-bottom: 0.08rem;
        }

        .mobile_number a {
            color: rgb(234, 0, 28) !important;
        }

        .mobile_quxiao_btn {
            color: rgb(0, 118, 255);
        }

        /*修改 展示 二维码 图片   5.9*/

        .erweima_img_box {
            width: 60% !important;
            padding-top: 0.25rem;
            margin-left: 20%;
            position: relative;
        }

        .erweima_img {
            width: 100%;
            height: 100%;
        }

        .erweima_tishi_wenzhi {
            padding-bottom: 0.4rem;
            margin-top: 0.13rem;
            text-align: center !important;
        }

        .wenxin_tishi {
            width: 100%;
            background: #FFFFFF;
            padding: 0.14rem;
        }

        .wenxin_tishi_title {
            color: rgb(51, 51, 51);
            font-size: 0.16rem;
            padding-bottom: 0.14rem;
        }

        .shangpinxinxi_erweima {
            margin-top: 0px;
            background: #ffffff;
        }

        /*一个二维码*/

        /*.img_state{
          width: 0.7rem;
          height: auto !important;
          right: -0.2rem;
          bottom: -0.2rem;
        }*/

        .erweima_name_tishi {
            margin-top: 0.4rem;
        }

        .tishi_shangpinxinxi_erweima_tupian {
            width: 75%;
            position: relative;
            margin: 0 auto;
            margin-top: 0.4rem;
        }

        .closeBtn {
            margin: 0 auto;
            width: 0.36rem;
            height: 0.36rem;
            margin-top: 1rem;
        }

        .bigerweima_btn {
            border-bottom: 1px solid rgb(230, 230, 230);
        }

        .bigerweima_btn:last-child {
            border-bottom: none !important;
        }

        .erweima_state_tishi {
            width: 30%;
            height: 0.4rem;
            border-radius: 0.2rem;
            margin: 0 auto;
            background: #ffdd10;
            line-height: 0.4rem;
            text-align: center;
            margin-top: 0.2rem;
        }

        #img_statesmal {
            width: 0.68rem;
            height: auto;
        }

        .v3 {
            width: 100%;
            height: 100%;
            background: #ccc;
            position: fixed;
            left: 0;
            top: 0;
            background: url("weixin/shop/pic/imgbg2.jpg") no-repeat;
            background-size: 100% 100%;
            display: none;
        }

        .V3show {
            width: 40%;
            height: 1.5rem;
            border: 1px solid rgb(51, 51, 51);
            position: absolute;
            left: 30%;
            bottom: .78rem;
            color: rgb(51, 51, 51);
            font-size: .16rem;
            background: url("weixin/shop/pic/img_kong.png") no-repeat;
            background-size: 100% 100%;
            z-index: 10;
        }

        .V3show img {
            width: 100%;
        }

        .colseV3 {
            width: .4rem;
            height: .4rem;
            color: rgb(51, 51, 51);
            font-size: .16rem;
            border-radius: .04rem;
            line-height: .4rem;
            position: absolute;
            right: .14rem;
            top: .2rem;
            text-align: center;
            z-index: 10;
        }

        .colseV3 img {
            width: 100%;
            animation: myfirst .2s linear .2s infinite alternate;
        }

        @keyframes myfirst {
            0% {
                opacity: 1;
            }
            50% {
                opacity: .1;
            }
            100% {
                opacity: 1;
            }
        }

        .colseV3p {
            text-align: center;
            margin-top: .4rem;
        }

        .v3mes {
            width: .6rem;
            height: .6rem;
            /*background: red;*/
            text-align: center;
            font-size: .14rem;
            position: absolute;
            left: -.3rem;
            top: -.3rem;
            bottom: 1.08rem;
            z-index: 10;
        }

        .v3mes img {
            width: 100%;
        }

        .v3mesG {
            color: rgb(9, 134, 17);
        }

        .v3mesR {
            color: rgb(195, 9, 74);
        }

        .v3opacity {
            width: 100%;
            height: 3.5rem;
            position: absolute;
            left: 0%;
            bottom: 0;
            background: url("weixin/shop/pic/img_shade.png") no-repeat;
            background-size: 100% 100%;
        }

        @media screen and (min-width: 376px) and (max-width: 414px) {
            .colseV3p {
                text-align: center;
                margin-top: .35rem;
            }
        }

        .shimingzhi {
            margin-top: .1rem;
            margin-bottom: .1rem;
            background: #ffffff;
            padding: .1rem;
            color: rgb(51, 51, 51);
        }

        .shimingzhi_box {
            margin-top: .1rem;
        }

        .shimingzhi_box p {
            margin-top: .05rem;
        }

        .shimingzhi_box p span:first-child {
            margin-right: .5rem;
        }

        .shangpinxinxi_youxianqi {
            padding-bottom: 0rem !important;
            margin-bottom: 0px;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="shangpinxinxi">
            <div class="shangpinxinxi_name_number border_bottom">
                <div class="shangpinxinxi_name font_16_color_51" id="prodcut_name"></div>
                <div class="shangpinxinxi_number font_14_color_128" style="margin-top:.14rem;margin-bottom:.14rem;"> 数量：<span id="product_surplusnumber"></span></div>
            </div>
            <div class="shangpinxinxi_youxianqi_erweima">
                <div class="shangpinxinxi_youxianqi">
                    <p class="font_14_color_128" id="timeto"><span id="timetofont">有效期至：</span><span class="font_14_color_233" id="orderexptime"></span></p>
                </div>
                <!-- <div class="shangpinxinxi_erweima">
                    <div class="shangpinxinxi_erweima_tupian"><div class="img_state"></div></div>
                    <p class="font_12_color_179">在使用时请出示二维码和票根</p>
                 </div> -->
            </div>
        </div>

        <div class="shangpinxinxi_erweima">
            <!-- 显示一个二维码<div class="erweima_img_box">
                                  <img src="" id="erweima_btn" class="erweima_img"/>
                                 <div class="img_state"></div>
              </div>
              <p class="font_12_color_179 erweima_tishi_wenzhi" >在使用时请出示二维码和票根</p> -->
        </div>

        <div class="shangpin_weizhi">
            <div class="dianming_mobile border_bottom">
                <div class="dianming font_16_color_51" id="shop_name"></div>
                <div class="mobile" id="mobile_btn"><img src="weixin/shop/pic/icon_phone.png" /></div>
            </div>
            <div class="address">
                <div class="dianming font_13_color_179 shangpin_weizhi_address">
                    <p id="address"></p>
                    <div class="adress_icon"><img src="weixin/shop/pic/icon_add_hui.png" /></div>
                </div>
            </div>
        </div>
        <div class="danhaoshijian_xiaohao">
            <div class="danhaoshijian bor_bottom">
                <p class="font_14_color_51">订单号：<span id="danhao"></span></p>
                <p class="font_14_color_51">下单时间：<span id="dingdan_time"></span></p>
            </div>
            <!-- <div class="xiaohao font_14_color_51">
                <div class="xiaohao_jinbi">
                           <p>金币小号</p>
                           <p class="xiaohao_erdu">0金币</p>
                       </div>
                 <div class="xiaohao_jifen">
                    <p>积分消耗</p>
                    <p class="xiaohao_erdu" id="jifen_xiaohao">0金币</p>
                </div>
                <div class="xiaohao_shifukuan">
                           <p>实付款</p>
                            <p class="xiaohao_erdu font_14_color_233">0金币</p>
                       </div>
            </div> -->
        </div>

        <!-- 实名制信息 -->
        <div class="shimingzhi" style="display:none">
            <div class="shimingzhi_title">实名制信息</div>
            <div class="shimingzhi_box">
                <p><span>张三</span><span>22222222222222222222</span></p>
            </div>
        </div>

        <div class="wenxin_tishi">
            <div class="wenxin_tishi_title">温馨提示</div>
            <div class="wenxin_tishi_centen"></div>
        </div>

    </div>
    <!--点击二位码  弹出 开始-->
    <div class="mengceng" style="display: none;"></div>

    <div class="erweima_tishi" style="display: none;">
        <div class="shangpinxinxi_erweima_tupian tishi_shangpinxinxi_erweima_tupian"><img id="big_erweima" src="weixin/shop/pic/icon_selected_wx.png" />
            <div class="img_state" id="img_statesmal"></div>
        </div>
        <p class="erweima_name_tishi"></p>
        <p class="erweima_state_tishi">立即使用</p>
        <!-- 已使用 已过期  立即使用-->
        <div class="closeBtn"><img class="close_btn_img" src="weixin/shop/pic/btn_close.png" /></div>
    </div>
    <!--点击二位码  弹出 结束 -->

    <!--点击 3V3  弹出 开始 -->
    <div class="v3">
        <div class="V3show">
            <p class="colseV3p" style="display:none">
                因安全需要，<br> 该二维码会在
                <br> 活动当天展示
                <br>
            </p>
            <img src="weixin/shop/pic/btn_close.png" id="V3showImg" style="display:none" />
            <div class="v3mes"></div>
        </div>
        <div class="colseV3"><img src="weixin/shop/pic/btn_close.png" /></div>
        <!-- <div class="v3opacity"></div> -->

    </div>

    <div class="mobile_html"></div>
    <div class="shezhi_tishi">
        <P>设置成功</P>
    </div>

    <script src="weixin/common/jquery.js"></script>
    <script src="weixin/common/fontSize.js"></script>
    <script src="weixin/common/common.js"></script>
    <script src="weixin/common/md5.js"></script>
    <script src="weixin/shop/js/common.js"></script>
    <script type="text/javascript" src="https://pingjs.qq.com/h5/stats.js" name="MTAH5" sid="500338441"></script>
    <script>
        var uid = "<?php echo $uid?>";
        var openid = "<?php echo $openid?>";
        var productid = '';
        var orderno = '';
        var usedatestatus = '';
        var producttype = '';
        var isPrize = "<?php echo $isPrize?>";
        var shangxun_orderNo = "<?php echo $shangxun_orderNo?>";

        var ordertype = "<?php echo $ordertype?>";
        getNowFormatDate();
        var nohouse="<?php echo $nohouse?>";
        if(nohouse!=1){
            // 返回  商城 主页
            goHomeBtn('body');
        }
        var arr_bigerweima = [];
        if(ordertype==2){
            $.ajax({
                url: WX_URL + 'requestAjax.php',
                type: 'POST',
                dataType: 'json',
                data: {
                    'uid': uid,
                    'orderID': shangxun_orderNo,
                    'identity': 'getAuctionOrderDetail'
                },
                success: function(res) {
                    console.log(res);
                }
            });
        }else{
            $.ajax({
                type: "post",
                url: COUPON_URL + "Home/Requestajax/getOrderInfoDetail",
                async: false,
                dataType: "json",
                data: {
                    "sign": md5_sign_tmp,
                    "timestamp": tmp,
                    "uid": uid,
                    "orderNo": shangxun_orderNo,
                    "isPrize": isPrize
                },
                success: function(data) {
                    console.log(data);
                    var data = data.result;
                    add_html(data);
                    var usestatus = ""
                    var centent_htm = ""
                    var centent_htm_new = ""
                    var statime = data.enddate;
                    var startdateobj = data.startdate.slice(0, 10);
                    var startdate = startdateobj + " 00:00:00";
                    // alert(startdate)
                    startdate = startdate.replace(/-/g, "/");
                    var startdate_ = new Date(startdate);
                    // alert(startdate_.getTime());
                    var dataS = startdate_.getTime();
                    // alert(dataS);
                    // 获取当前时间戳
                    var timestamp1 = Date.parse(new Date());
                    // alert(timestamp1);
                    // alert(timestamp1);

                    if (parseInt(timestamp1) < parseInt(dataS)) {
                        //显示文字
                        $(".colseV3p").show();
                    } else {
                        // 显示二维码
                        $("#V3showImg").show();
                        $(".v3").css({
                            'background': 'url("weixin/shop/pic/imgbg3.jpg") no-repeat',
                            'background-size': '100% 100%'
                        })
                        $(".V3show").css({
                            'background': 'none',
                            'height': 'auto',
                            'width': '75%',
                            'left': '12.5%',
                            'bottom': '.75rem',
                            'border': 'none'
                        })
                    }
                    usedatestatus = data.usedatestatus;
                    productid = data.productid;
                    orderno = data.orderno;
                    producttype = data.producttype;
                    needrealname = data.needrealname;
                    if (needrealname == 1) {
                        $(".shangpinxinxi_erweima").hide();
                    }
                    // 获取时间 差值  time_yu  判断 使用过？ 已过期？
                    GetDateDiff(statime, currentdate_start, "minute");
                    $.each(data.qcodeinfo, function(i, k) {
                        centent_htm_new += erweima_html(k);
                    });
                    if (data.realnamelist.length > 0) {
                        $(".shimingzhi").show();
                        var shiming = '';
                        $.each(data.realnamelist, function(i, k) {
                            shiming += '<p><span>' + k.name + '</span><span>' + k.idcard + '</span></p>';
                        });
                        $(".shimingzhi_box").html(shiming);
                    }
                    // 多个 二维码
                    $(".shangpinxinxi_erweima").append(centent_htm_new);
                },
                error: function() {
                    alert("错误")
                }
            });

        }

        $(".erweima_tupian").on("click", function() {
            var index = $(this).index();
            var stateFont = '';
            var color = "";
            var bgcolor = "";
            var verifycode = $(this).attr("verifycode");
            console.log(index);
            console.log(arr_bigerweima[index]);
            var img_url = arr_bigerweima[index];
            $("#big_erweima").attr("src", img_url);
            $("#V3showImg").attr("src", img_url);
            if (parseInt(producttype) == 13) {
                $(".v3").show();
            } else {
                $(".mengceng").show();
                $(".erweima_tishi").show();
            }
            var imgsmall = '';

            var v3mesfont = '';
            var v3mesfontClass = '';
            if ($(this).attr("state") == 0) { // 已使用
                stateFont = '已使用';
                color = "rgb(122,122,122)";
                bgcolor = 'rgb(204,204,204)';
                imgsmall = '<img class="img_state_Img" src="weixin/shop/pic/icon_Already_use.png"/>';
                // 入场
                // v3mesfont="已入场";
                // v3mesfont='<img src="weixin/shop/pic/icon_admision.png"/>';
                v3mesfont = '<img src="weixin/shop/pic/icon_admission.png"/>';
                v3mesfontClass = "v3mesG";
            } else if ($(this).attr("state") == 1) { //已过期
                stateFont = '已过期';
                color = "rgb(122,122,122)";
                bgcolor = 'rgb(204,204,204)';
                imgsmall = '<img class="img_state_Img" src="weixin/shop/pic/icon_overdue.png"/>';
                // v3mesfont="已过期";
                v3mesfont = '<img src="weixin/shop/pic/icon_Expired.png"/>';
                v3mesfontClass = "v3mesR";
            } else if ($(this).attr("state") == 2) { //未使用
                console.log(usedatestatus)
                if (usedatestatus == 1) { //不可用
                    stateFont = '今日不可用';
                    color = "rgb(122,122,122)";
                    bgcolor = 'rgb(204,204,204)';
                } else {
                    stateFont = '立即使用';
                    $(".erweima_state_tishi").attr("click", "true");
                    $(".erweima_state_tishi").attr("verifycode", verifycode);
                    color = "rgb(51,51,51)";
                    bgcolor = '#ffdd10';
                }
            } else if ($(this).attr("state") == 3) { //未使用
                // v3mesfont="已出场";
                v3mesfont = '<img src="weixin/shop/pic/icon_Departure.png"/>';
                v3mesfontClass = "v3mesR";
            }
            //判断入场 状态
            $(".v3mes").html(v3mesfont);
            $(".v3mes").addClass(v3mesfontClass);
            $(".erweima_state_tishi").html(stateFont);
            $(".erweima_state_tishi").css({
                "color": color,
                'background': bgcolor
            });
            $("#img_statesmal").html(imgsmall);
            $("#img_statesmal").css({
                'right': ' -0.3rem',
                'bottom': '-0.3rem'
            })
        })

        $(".close_btn_img").on("click", function() {
            window.location.reload();
        })

        //添加 结构
        function add_html(data) {
            var all_pice = data.buynumber * data.price;
            $("#jifen_xiaohao").html(all_pice + "积分");
            $("#danhao").html(data.orderno);
            $("#dingdan_time").html(data.ordertime);
            $("#prodcut_name").html(data.productname);
            $(".erweima_name_tishi").html(data.productname);
            $("#product_surplusnumber").html(data.buynumber);
            $("#shop_name").html(data.shopname);
            $("#address").html(data.address);
            var arr_phone = data.phone.split(",");
            if (parseInt(data.producttype) == 13) {
                $("#timetofont").html("开始时间：");
                $("#orderexptime").html(data.startdate);
            } else {
                $("#timetofont").html("有效期至：");
                $("#orderexptime").html(data.enddate);
            }

            for (var i = 0; i < arr_phone.length; i++) {
                console.log(arr_phone[i]);
                var html = '<div class="mobile_number">' +
                    '<a href="tel:' + arr_phone[i] + '" id="shop_mobile">' + arr_phone[i] + '</a>' +
                    '</div>';
                $(".mobile_html").attr("iii", i);
                $(".mobile_html").append(html);
            }
            $(".mobile_html").append('<div class="mobile_quxiao_btn">取消</div>');
            $(".wenxin_tishi_centen").html(data.remindertext);
        }

        // 二维码 结构
        function erweima_html(k) {
            //console.log(k);
            var usestatus = "";
            var centent_htm = "";
            var state = 2; // 0 已使用  // 1 商品 过期
            arr_bigerweima.push(k.verifyurl);
            //usestatus = '<img class="img_state_Img" src="weixin/shop/pic/icon_overdue.png"/>';
            if (k.usestatus == 1) { // 已使用
                usestatus = '<img class="img_state_Img" src="weixin/shop/pic/icon_Already_use.png"/>';
                state = 0;
            } else if (k.usestatus == 2) { //出场
                usestatus = '<img class="img_state_Img" src="weixin/shop/pic/icon_Departure.png"/>';
                state = 3;
            } else {
                if (time_yu > 0) {
                    usestatus = '<img class="img_state_Img" src="weixin/shop/pic/icon_overdue.png"/>';
                    state = 1;
                }
            }
            centent_htm += '<div class="erweima_tupian bigerweima_btn" state="' + state + '" verifycode="' + k.verifycode + '" >' +
                '<div class="erweima_list">二维码<span class="see_youhuiquan" style="color:green;margin-left:0.1rem">（点击查看二维码）</span></div>' +
                '<div class="img_state">' + usestatus + '</div>' +
                '</div>';
            return centent_htm;
        }

        /*点击 电话 图标  显示拨打电话号*/
        $("#mobile_btn").on('click', function() {
            show_mengceng();
            // var h=$(".mobile_html").attr('iii');
            // if(h==0){
            //     h=1;
            // }
            // var H=$(".mobile_html").height();
            // console.log(H);
            $(".mobile_html").css({
                "bottom": "0.1rem",
                "transition": " bottom 0.3s",
                "-moz-transition": " bottom 0.3s",
                /* Firefox 4 */
                "-webkit-transition": "bottom 0.3s",
                /* Safari 和 Chrome */
                "-o-transition": " bottom 0.3s",
            })
        })

        $(".mobile_quxiao_btn").on("click", function() {
            $(".mobile_html").css({
                "bottom": "-5rem",
                "transition": " bottom 0.3s",
                "-moz-transition": " bottom 0.3s",
                /* Firefox 4 */
                "-webkit-transition": "bottom 0.3s",
                /* Safari 和 Chrome */
                "-o-transition": " bottom 0.3s",
            })
            $(".dongtaimengceng").remove();
        })


        //点击立即使用
        $(".erweima_state_tishi").on("click", function() {
            if ($(this).attr("click") == "true") {
                var obj = $(this);
                $(".erweima_tishi").hide();
                twoanniu("确定要使用吗？", "确定", "取消", obj);
            } else {
                return false;
            }
        })

        // 关闭 3v3 弹窗
        $(".colseV3").on("click", function() {
            $(".v3").hide();
            window.location.reload();
        })

        // 立即使用
        function funUse(obj) {
            console.log(3333);
            var verifycode = obj.attr("verifycode");
            var data = {
                "verifyCode": verifycode,
                "productId": productid,
                "openId": openid,
                "orderNo": orderno
            };
            var datanew = createSign(data);
            //useVerifyCodeSelf   参数verifyCode
            $.ajax({
                type: "post",
                url: COUPON_URL + "Home/Requestajax/useVerifyCodeSelf",
                async: false,
                dataType: "json",
                data: datanew,
                success: function(data) {
                    console.log(data);
                    if (data.state == 0) {
                        // 成功
                        $(".erweima_state_tishi").html("已使用");
                        $(".erweima_state_tishi").css({
                            "color": "rgb(122,122,122)",
                            'background': "rgb(204,204,204)"
                        })
                        $(".erweima_state_tishi").attr("click", "false");
                    } else {
                        tishi(data.result)
                    }
                },
                error: function() {
                    console.log("错误");
                }
            });
        }

        function twoanniu(centen_wenzi, anniu_wenziL, anniu_wenziR, obj) {
            var tishikuang_html =
                "<div id='twoanniuBox' style='width: 90%;height: 2rem;position: fixed;background: #ffffff; border-radius: 0.04rem; left: 5%;top: 0.69rem;z-index:500'><div style='padding-bottom: 0.36rem;padding-top: 0.6rem;text-align: center;border-bottom: 1px solid rgb(230,230,203);color: rgb(51,51,51);font-size: 0.16rem;'>" +
                centen_wenzi +
                "</div><div style='margin:0.2rem 0 ;width: 40%;float:left;margin-left: 7%;height: 0.4rem;background: rgb(255,221,16);border-radius: 0.2rem;font-size: 0.16rem;color: rgb(51,51,51);text-align: center;line-height: 0.4rem;' id='falsebtn'>" +
                anniu_wenziL +
                "</div><div style='margin:0.2rem 0 ;width: 40%;margin-right: 7%;height: 0.4rem;background: rgb(255,221,16);border-radius: 0.2rem;font-size: 0.16rem;color: rgb(51,51,51);text-align: center;line-height: 0.4rem; float:right;' id='truebtn'>" +
                anniu_wenziR + "</div></div>";
            $("body").append(tishikuang_html);
            $("#falsebtn").on("click", function() {
                $("#twoanniuBox").remove();
                $(".erweima_tishi").show();
                funUse(obj);
            })
            $("#truebtn").on("click", function() {
                $("#twoanniuBox").remove();
                $(".erweima_tishi").show();
            })
        }

        // twoanniu("centen_wenzi", "anniu_wenzi", "anniu_wenzi");
    </script>
</body>

</html>
