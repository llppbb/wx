<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <!--禁止页面缩放-->
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
    <title>地址列表</title>
    <link rel="stylesheet" href="weixin/addresslist/css/getadress.css">
    <link rel="stylesheet" href="weixin/addresslist/css/dizhiliebiao.css">
    <link rel="stylesheet" href="weixin/common/common.css">
    <style>
       .zengjiadizhi{
           line-height: .16rem;
           color: #333333;
           font-size: .13rem;
           text-align: right;
           padding: .16rem .14rem 0rem 0rem;
       }
       .zengjiadizhi span{
           position: relative;
       }
       .zengjiadizhi span img{
            position: absolute;
           width: .16rem;
           height:  .16rem;
           left: -.2rem;
           top: 0rem;
       }
       .dizhi {
            width: 96%;
            margin-left: 2%;
            background: none;
            border: 1px solid #E6E6E6;
       }
       html,body,.wrap{
           background: #ffffff;
       }
       .dizhi_state {
            padding: 0.07rem !important;
            height: .3rem;
            margin-top: 0.14rem;
            border-top: 1px solid rgb(230,230,230);
            background: #FCFCFC;
        }
        .xingmingshoujihao p {
            margin-top: 0.14rem;
            margin-bottom: 0.14rem;
        }
        .dizhi_liebiao {
             margin-bottom: 0rem;
        }
        .dizhi_state_right {
            float: right;
            padding-bottom: 0rem;
        }
        .xingmingshoujihao p:nth-of-type(2) {
            color: #808080;
        }
    </style>
</head>

<body>
    <div class="wrap">

        <div class="zengjiadizhi"><span><img src="weixin/addresslist/pic/icon_add.png"/>添加收货地址</span></div>

        <?php foreach($addresslist as $v) {?>
        <div class="dizhi" id="ad_<?php echo $v['id']?>">
            <div class="dizhi_liebiao">
                <div class="xingmingshoujihao">
                    <p>
                        <?php echo $v['name']?>
                    </p>
                    <p>
                        <?php echo $v['mobile']?>
                    </p>
                </div>
                <div class="xiangxidizhi">
                    <p>
                        <?php echo $v['address']?>
                    </p>
                    <div class="jianhao">
                        <!--<img src="weixin/addresslist/pic/gengduo.png" />-->
                    </div>
                </div>
                <div class="dizhi_state">
                    <div class="dizhi_state_left" dataType="<?php echo $v['id']?>" defaultValue="<?php echo empty($v['defaultValue'])?'false':'true' ?>">
                        <div class="dizhi_state_img_moren">
                            <?php if($v['defaultValue'] == 1) {?>
                            <img src="weixin/addresslist/pic/icon_sec.png" class="img_img morendizhi_btn_img" />
                            <?php } else {?>
                            <img src="weixin/addresslist/pic/icon_mr_gray.png" class="img_img morendizhi_btn_img" />
                            <?php }?>
                        </div>
                        <div class="morendizhi_wenzi">默认地址</div>
                    </div>
                    <div class="dizhi_state_right">
                        <div class="dizhi_state_img_bianji">
                            <img src="weixin/addresslist/pic/icon_bj.png" class="img_img" />
                        </div>
                        <div class="bianjiBtn" dataType="<?php echo $v['id']?>" defaultValue="<?php echo empty($v['defaultValue'])?'false':'true' ?>">编辑</div>
                        <div class="dizhi_state_img_remove">
                            <img src="weixin/addresslist/pic/icon_delete.png" class="img_img" />
                        </div>
                        <div class="removeBtn" aid="<?php echo $v['id']?>" defaultValue="<?php echo empty($v['defaultValue'])?'false':'true' ?>">删除</div>
                    </div>
                </div>
            </div>
        </div>
        <?php }?>

    </div>
    <!--蒙层-->
    <div class="mengceng"></div>
    <!--取消订单-->
    <div class="quxiaodingyaoBox" style="z-index:22">
        <p>确定要删除此收货地址信息？</p>
        <div class="anniu anniuQx">
            <div class="quxiaodingdan quxiaodingdanQx" id="fou">否</div>
            <div class="zhifu" id="shi">是</div>
        </div>
    </div>
    </div>
    <div class="shezhi_tishi">
        <P>设置成功</P>
    </div>
    <script src="weixin/common/jquery.js"></script>
    <script src="weixin/common/fontSize.js"></script>
    <script src="weixin/common/common.js"></script>
    <script>
        window.onpageshow = function(event) {
            if (event.persisted) {
                window.location.reload();
            }
        };
        var aid = '';
        var uid = "<?php echo $uid?>";
        $(".removeBtn").click(function(event) {
            if ($(this).attr('defaultValue') == 'true') {
                tishi('不能删除默认地址！');
                return;
            }
            aid = $(this).attr('aid');
            $('.mengceng').show();
            $('.quxiaodingyaoBox').show();
        });

        $("#fou").click(function(event) {
            $('.mengceng').hide();
            $('.quxiaodingyaoBox').hide();
        });

        $("#shi").click(function(event) {
            $.ajax({
                    url: WX_URL + 'requestAjax.php',
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        'uid': uid,
                        'id': aid,
                        'identity': 'deleteUserAddress'
                    }
                })
                .done(function(res) {
                    console.log(res);
                    if (res.state == 0) {
                        $('#ad_' + aid).remove();
                        $('.quxiaodingyaoBox').hide();
                        setTimeout(function() {
                            $('.mengceng').hide();
                        }, 50);
                    } else {
                        tishi(res.message);
                    }
                })
                .fail(function(res) {
                    // tishi("error");
                    console.log(res)
                });
        });

        $(".bianjiBtn").click(function(event) {
            var aid = $(this).attr('dataType');
            location.href = WX_URL + "user.php?addressList=1&addOrEditTicketAddress=edit&aid=" + aid;
        });

        $(".dizhi_state_left").click(function(event) {
            var that = this;
            var defaultValue = $(this).attr('defaultValue');

            if (defaultValue == 'true') {
                return;
            } else {
                defaultValue = 'true';
            }
            var data = {
                uid: uid,
                id: $(this).attr('dataType'),
                defaultValue: defaultValue,
                name: $(this).parent().parent().children(":first").find('p:first').text(),
                mobile: $(this).parent().parent().children(":first").find('p:eq(1)').text(),
                address: $(this).parent().parent().children(":nth-child(2)").find('p').text(),
                identity: 'updateUserAddress'
            }
            $.post(WX_URL + 'requestAjax.php', data, function(res) {
                if (res.state == 0) {
                    $(that).attr('defaultValue', 'true');
                    $(that).siblings(".dizhi_state_right").children(".removeBtn").attr('defaultValue', 'true');
                    $(that).find("img").attr("src", "weixin/addresslist/pic/icon_sec.png")
                    $(that).parents(".dizhi").siblings().find(".morendizhi_btn_img").attr("src", "weixin/addresslist/pic/icon_mr_gray.png");
                    $(that).parents(".dizhi").siblings().find(".dizhi_state_left").attr('defaultValue', 'false');
                    $(that).parents(".dizhi").siblings().find(".dizhi_state_left").siblings(".dizhi_state_right").children(".removeBtn").attr('defaultValue', 'false');
                } else {
                    tishi(res.message);
                    return;
                }
            }, 'json');
        });

        $(".zengjiadizhi").on("click", function() {
            var uid = $("#uid").val();
            location.href = WX_URL + "user.php?addressList=1&addOrEditTicketAddress=add";
        })
        // 禁用微信分享
              function onBridgeReady() {
                     WeixinJSBridge.call('hideOptionMenu');
                }

               if (typeof WeixinJSBridge == "undefined") {
                   if (document.addEventListener) {
                       document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
                   } else if (document.attachEvent) {
                       document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
                       document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
                   }
               } else {
                   onBridgeReady();
               }
    </script>
</body>

</html>
