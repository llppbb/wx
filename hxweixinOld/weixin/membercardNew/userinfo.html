<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no" />
    <!--禁止页面缩放-->
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" id="viewport" name="viewport">
    <title>个人信息</title>
    <link rel="stylesheet" type="text/css" href="weixin/membercardNew/css/activatecar.css" />
    <link rel="stylesheet" type="text/css" href="weixin/common/common.css" />
    <style>
        .wrap {
            display: -webkit-flex;
            -webkit-flex-direction: column;
            font-size: .15rem;
            padding: 0px;
            padding-top: .1rem;
        }

        .mobile {
            display: flex;
            -webkit-flex-direction: row;
            background: #fff;
            margin-top: 0rem;
            border: none;
            border-bottom: 1px solid rgb(227, 227, 227);
        }

        .mobile p {
            padding: .2rem .19rem .19rem .1rem;
        }

        .carState {
            margin-top: 1.5rem;
            line-height: .45rem;
            width: 60%;
            margin-left: 20%;
        }

        .mobile div {
            margin-top: .2rem;
        }

        #mobile,
        #birthday {
            color: #ccc !important;
            background: #fff !important;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="mobile">
            <p>手机</p>
            <input id="mobile" type="number" placeholder="请输入手机号" class="phone" disabled="ture" />
        </div>
        <div class="mobile" id="nameBox">
            <p>姓名</p>
            <input type="text" placeholder="请输入姓名" id="name" />
        </div>
        <div class="mobile birthday">
            <p>性别</p>
            <select name="selecte" id="sex">
                <option value="男" id="boy">男</option>
                <option value="女" id="girl">女</option>
            </select>
        </div>
        <div class="mobile birthday">
            <p>生日</p>
            <div id="birthday"></div>
        </div>
        <div class="mobile birthday">
            <p>详细地址</p>
            <input id="address" type="text" placeholder="" />
        </div>
        <div class="carState activate" id="activate" act="0">提交修改</div>
    </div>
    <div class="mengceng"></div>

    <div class="shezhi_tishi">
        <p></p>
    </div>
</body>
<script src="weixin/membercardNew/js/jquery-1.8.2.min.js"></script>
<script src="weixin/membercardNew/js/fontSize.js"></script>
<script src="weixin/membercardNew/js/datePicker.js"></script>
<script src="weixin/common/common.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="https://pingjs.qq.com/h5/stats.js" name="MTAH5" sid="500338441"></script>

<script type="text/javascript">
    window.onpageshow = function(event) {
        if (event.persisted) {
            window.location.reload();
        }
    };

    var data = <?php echo $obj?>;
    console.log(data);
    var openid = "<?php echo $openid?>";
    $("#mobile").val(data.result.mobile);
    $("#name").val(data.result.name);
    $("#birthday").html(data.result.birthday.slice(0, 10));
    $("#address").val(data.result.address);

    if (data.result.sex == "男") {
        $("#boy").prop("selected", true);
    } else {
        $("#girl").prop("selected", true);
    }

    // 提交修改
    $("#activate").click(function(event) {
        if ($(this).hasClass('activate')) {
            /* Act on the event */
            var arr = {};
            arr.name = $("#name").val();
            arr.sex = $("#sex").val();
            arr.address = $("#address").val();
            arr.openid = openid;
            $.ajax({
                url: WX_URL + 'requestAjax.php',
                type: 'POST',
                dataType: 'json',
                async: false,
                data: {
                    'code': data.result.code,
                    'openid': openid,
                    'dataArr': arr,
                    'identity': 'reviseUserCardInfo'
                },
                success: function(data) {
                    console.log(data);
                    if (data.state == 0) {
                        tishi("修改成功");
                        window.location.reload();
                    } else {
                        // alert(data.result);
                    }
                }
            })
        }
    });
    // 加载回到主面按钮
    goHomeBtn("body");
    var appId = '<?php echo APPID?>';
    var nonceStr = '<?php echo $nonceStr;?>';
    var timestamp = '<?php echo $timestamp;?>';
    var signature = '<?php echo $signature;?>';
    // 微信分享
    wx.config({
        debug: false,
        appId: appId,
        timestamp: timestamp,
        nonceStr: nonceStr,
        signature: signature,
        jsApiList: ['checkJsApi', 'onMenuShareAppMessage']
    });
    wx.ready(function() {
        wx.checkJsApi({
            jsApiList: ['onMenuShareAppMessage'],
            success: function(res) {
                console.log(res);
            }
        });
        wx.onMenuShareAppMessage({
            title: '吃喝玩乐 华熙LIVE一卡通', // 分享标题
            desc: '花钱有积分，积分当钱花！', // 分享描述
            link: WX_URL + 'user.php?userInfo=1', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
            imgUrl: WX_URL + 'tmp/title.png', // 分享图标
            type: '', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function() {
                // 用户确认分享后执行的回调函数
                console.log("分享成功");
            },
            cancel: function() {
                // 用户取消分享后执行的回调函数
                console.log("取消分享");
            }
        });
    });
    wx.error(function(res) {
        // console.log(res);
    });
</script>

</html>
